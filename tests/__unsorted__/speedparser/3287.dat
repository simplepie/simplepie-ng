<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" media="screen" href="/~d/styles/atom10full.xsl"?><?xml-stylesheet type="text/css" media="screen" href="http://feeds.feedburner.com/~d/styles/itemcontent.css"?><feed xmlns="http://www.w3.org/2005/Atom" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#" xmlns:feedburner="http://rssnamespace.org/feedburner/ext/1.0">

  <title>Literate Programming</title>
  
  <link href="http://blog.steveklabnik.com/" />
  <updated>2011-10-01T14:49:45-05:00</updated>
  <id>http://blog.steveklabnik.com/</id>
  <author>
    <name>Steve Klabnik</name>
    
  </author>

  
  <atom10:link xmlns:atom10="http://www.w3.org/2005/Atom" rel="self" type="application/atom+xml" href="http://feeds.feedburner.com/SteveKlabnik" /><feedburner:info uri="steveklabnik" /><atom10:link xmlns:atom10="http://www.w3.org/2005/Atom" rel="hub" href="http://pubsubhubbub.appspot.com/" /><geo:lat>40.454018</geo:lat><geo:long>-79.9325</geo:long><link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/2.0/" /><feedburner:emailServiceId>SteveKlabnik</feedburner:emailServiceId><feedburner:feedburnerHostname>http://feedburner.google.com</feedburner:feedburnerHostname><entry>
    <title>GitHub Is Anarchy for Programmers</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/fCYygNgSMDI/github-is-anarchy-for-programmers.html" />
    <updated>2011-10-01T13:01:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/10/01/github-is-anarchy-for-programmers</id>
    <content type="html">&lt;p&gt;I finally got to see Zach Holman give his talk, &lt;a href="http://speakerdeck.com/u/holman/p/how-github-uses-github-to-build-github"&gt;How GitHub Uses GitHub to Build GitHub&lt;/a&gt;.
It was awesome. Zach is a great speaker, and the slides don&amp;#8217;t do it justice. I
highly recommend catching it on video or in person sometime.&lt;/p&gt;

&lt;p&gt;Anyway, there&amp;#8217;s something that I found really interesting about GitHub&amp;#8217;s
&amp;#8216;process&amp;#8217;: it&amp;#8217;s basically anarchism, applied to software development.&lt;/p&gt;

&lt;p&gt;If you&amp;#8217;re not familliar with anarchism, check out &lt;a href="http://truth-reason-liberty.blogspot.com/p/what-i-believe-in.html"&gt;&amp;#8220;What I believe in&amp;#8221;&lt;/a&gt;.
It&amp;#8217;s a pretty decent introduction to a complicated topic. Ultimately, anarchism
is fairly simple, but it requires dismantling a &lt;em&gt;lot&lt;/em&gt; of beliefs that Americans
in particular hold about society, power, and control. We&amp;#8217;re quite happy in this
country to be slaves to the rich, but that&amp;#8217;s another blog post. ;)&lt;/p&gt;

&lt;p&gt;Another excellent post on that blog is &lt;a href="http://truth-reason-liberty.blogspot.com/2010/11/digression-on-what-it-means-to-be.html"&gt;&amp;#8220;A Digression On What It Means to Be An Anarchist&lt;/a&gt;.
I&amp;#8217;m going to use it as a framework to point out my comparison to GitHub. The
first sentence is stolen from TFA, but the second sentence is my GitHub
comparison.&lt;/p&gt;

&lt;h2&gt;What anarchists oppose&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Hierarchy – anarchists oppose domination of one person or group of people by
another as detrimental to human society. GitHub has built a very flat process,
where &amp;#8220;some days the CEO ships more code than I do.&amp;#8221;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Authority – all forms of authority must bear a heavy burden of proof in order
to demonstrate their legitimacy and necessity. GitHub has hired people that have
built awesome things, and have shown themselves to be a trusted authority in
whatever kind of software that they build. Nobody needs to question if anyone
is in the position to deploy or review some code.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The state – centralised rule of a set geographical area (country) or people
(nation) by a government of elites is inherently illegitimate. Okay, this has
nothing to do with GitHub all together. All abstractions are leaky here. :)
The same goes for Capitalism and State Socialism too.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Nationalism and fascism – these are but the worst forms of the state, gaining
the loyalty of the people with strong, often brutal discipline and by developing
an almost religious, fevered love of the state and the rulers in the form of
patriotism. GitHub actively uses multiple programming languages in production,
and while it came out of the Ruby world, they don&amp;#8217;t really run around pitching
&amp;#8220;Ruby is awesome and the only thing you should ever use.&amp;#8221;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Discrimination – nobody should be excluded or discriminated against based on
nothing more than their gender, ethnicity, sexuality, background, or beliefs. I
don&amp;#8217;t know everyone at GitHub, but it&amp;#8217;s a pretty diverse crew overall. This is
hard for any tech company, but they&amp;#8217;re doing pretty well on the race/sex thing.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;What anarchists stand for&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Liberty – all people should be free to live their life as they see fit,
without rules and laws passed from above that serve no purpose other than
control and domination, as long as they are not infringing the right of anybody
else to the same. See Homan&amp;#8217;s talk. That&amp;#8217;s pretty much how they work.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Equality – as stated above, nobody should face discrimination because of their
gender, ethnicity, sexuality, background, or beliefs. See above comment about
GitHub&amp;#8217;s varied devs.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Community – human civilisation evolved, from its primitive roots, through the
priciple of Mutual Aid. GitHub has a lot of elements of mutal aid in their
process, where they mention some people in some pull requests, work together
on features, and generally high five until the code is running in production.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Solidarity – humanity is divided only between the rulers and the ruled. Other
divisions, those which bring about sexism, racism, heterosexism, and other
bigotries, are promoted by the ruling class in order to divide their subjects
and keep them under control. GitHub holds tons of events, buys everyone lots of
beer, and just generally encourages lots of friendly interactions between
everyone. CodeConf was a great group of diverse people hanging out and having
a good time.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;How anarchy would work&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Self-management – groups, such as workforces or local communities, would be
free to operate and govern themselves free of any higher authority. GitHub has
no deadlines, no prioritization meetings, and 100% &amp;#8220;do what you want&amp;#8221; time.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Free association – all individuals would be free to live where they wanted and
associate with who they chose. Zach mentioned in his talk that different people
work on different parts of the site, and it&amp;#8217;s really based on what people are
interested in and what they&amp;#8217;ve done in the past.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Voluntary federation – instead of the state, where indivudal communities and
groups of people are bound together by the coercive force of a central
authority, local communities and workers collectives can choose for themselves
which other communities or collectives to associate with. Sort of like the free
association comment, people get together and work on what they want to, and
these groups are organic.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Direct democracy – unlike in parliamentary democracy, these spokespeople would
be just that, elected not to a position of authority but to voice decisions that
remain in the hands of the people, as in trade union and workers council
structures. Anybody can comment on a pull request, add some commits, put in
their two cents, and be heard.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Mutual Aid – in participatory communities and workers collectives, Mutual Aid
is a central principle. Easily summed up with the phrase “from each according to
his ability, to each according to his need,” this boils down to voluntary
cooperation, fair distribution of resources, and help and support to those who
need it within a local community. As mentioned before, everybody helps each
other out at GitHub to get things done.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Free, fair trade – for the sharing of resources between different communities
and individuals who opt out of Mutual Aid, anarchy would see the emergence of a
truly free market. This doesn&amp;#8217;t really fit with software, I think. Same with
&amp;#8216;individual liberty.&amp;#8217;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Collective defence – this is not to say that anarchist society will contain
“perfect people,” and there will certainly be acts of aggression, oppression,
and violence – albeit on a lesser scale than is commonplace in today’s world.
I&amp;#8217;d liken this to things like &amp;#8220;the site is down.&amp;#8221; Everyone at GitHub cares about
GitHub being up, and so they don&amp;#8217;t need someone who&amp;#8217;s responsible for &amp;#8216;defense,&amp;#8217;
as if shit hits the fan, everyone chips in and takes care of it.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Justice, not vengeance – courts would be elected for each individual case,
rather than appointed and given unnecessary authority, with the aim to establish
guilt or innocence, negotiate reparations, and organise rehabilitation rather
than to support the oppressive prison systems which only make matters worse by
serving as little more than universities of crime. I&amp;#8217;m not sure this fits well
here.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;All abstractions are leaky&lt;/h2&gt;

&lt;p&gt;Just like when &amp;#8216;lean&amp;#8217; was a concept that applied manufacturing techniques to
software development, I don&amp;#8217;t think that &amp;#8216;anarchism&amp;#8217; is a 100% fit with GitHub&amp;#8217;s
process. I do think that it&amp;#8217;s close enough to hold a lot of value, however,
even to the point that Zach had to write a blog post about &lt;a href="http://zachholman.com/posts/scaling-github-employees/"&gt;scaling&lt;/a&gt;,
which is something that &lt;em&gt;always&lt;/em&gt; gets leveled at people talking about anarchism.
I see GitHub in the same way that I see &lt;a href="http://en.wikipedia.org/wiki/Anarchism_in_Spain"&gt;anarchist Catalonia&lt;/a&gt; or the &lt;a href="http://en.wikipedia.org/wiki/Free_Territory"&gt;Free Territory&lt;/a&gt; in the Ukraine.
It&amp;#8217;s a place where ideals are actually working in practice. Let&amp;#8217;s just hope that
the &lt;a href="http://en.wikipedia.org/wiki/Anarchist_Catalonia#Clashes_with_the_Communists"&gt;communists don&amp;#8217;t betray them when the fascists show up&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Damn leaky abstractions.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=fCYygNgSMDI:IO9f5lvyXBk:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=fCYygNgSMDI:IO9f5lvyXBk:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=fCYygNgSMDI:IO9f5lvyXBk:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=fCYygNgSMDI:IO9f5lvyXBk:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=fCYygNgSMDI:IO9f5lvyXBk:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/fCYygNgSMDI" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/10/01/github-is-anarchy-for-programmers.html</feedburner:origLink></entry>
  
  <entry>
    <title>(Real) Modern Ruby Development</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/ewbsE-rzUrE/real-modern-ruby-development.html" />
    <updated>2011-09-28T06:31:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/09/28/real-modern-ruby-development</id>
    <content type="html">&lt;p&gt;I came across a blog post the other day titled &lt;a href="http://ascarter.net/2011/09/25/modern-ruby-development.html"&gt;Modern Ruby Development&lt;/a&gt;.
While it&amp;#8217;s a perfectly fine blog post (other than the digs at rvm&amp;#8230;) it really
should have been titled something more along the lines of &amp;#8220;My default tooling
to build a Rails application.&amp;#8221; I thought of this yesterday, as I was invited
to show up at &lt;a href="http://www.vertigo.com/"&gt;Vertigo&lt;/a&gt; and show them how we do things
in the Open Source world. Vertigo builds lots of cool things, but they tend to
be very .NET centric, and it was neat for both of us to see how the other half
lives.&lt;/p&gt;

&lt;p&gt;Shortly before my &amp;#8216;presentation,&amp;#8217; we decided that I&amp;#8217;d basicaly just build a
little web app in front of them. Live coding to the max! We decided for maximum
awesome, and since I was in town for the Twilio conference, that I&amp;#8217;d make a
Twilio app that they could text and it&amp;#8217;d text you &amp;#8216;hello world: you said #{msg}&amp;#8221;
back. I thought I&amp;#8217;d share that process with you, too. I ended up throwing away
the code, though, because I committed my account credentials into the git repo
to simplify things, so I&amp;#8217;ll just be describing it to you. Check my other posts
for code stuff. ;)&lt;/p&gt;

&lt;p&gt;Oh, and one more thing: lots of this stuff is about getting &amp;#8216;iteration zero&amp;#8217; out
of the way: it&amp;#8217;s setup work that you have to do to set the tone for everything
else. In its own way, it&amp;#8217;s also a tooling overview, I&amp;#8217;ve just focused on the
tools that help the process rather than the language stuff. I&amp;#8217;ve already written
a more &amp;#8216;dev proccess&amp;#8217; style post over at &lt;a href="http://timelessrepo.com/bdd-with-rspec-and-steak"&gt;Timeless&lt;/a&gt;,
about BDD.&lt;/p&gt;

&lt;h2&gt;rvm &amp;#8211;rvmrc &amp;#8211;create 1.9.2@hello_text&lt;/h2&gt;

&lt;p&gt;First up: decide what Ruby you&amp;#8217;re using. I talked breifly about MRI, Rubinius,
and JRuby, and some pros and cons for each. I still tend to use MRI for my
production code at the moment, but soon, rbx will become my default.&lt;/p&gt;

&lt;p&gt;I use rvm because it does exactly what I want.&lt;/p&gt;

&lt;h2&gt;mvim README.md&lt;/h2&gt;

&lt;p&gt;I really enjoy &lt;a href="http://tom.preston-werner.com/2010/08/23/readme-driven-development.html"&gt;README driven development&lt;/a&gt;.
I didn&amp;#8217;t actually demo this due to time constraints, but I generally write at
least a minimal README.md before doing anything else. During Windy City Rails,
Tom shared something that he likes doing: &lt;code&gt;mv README.md SPEC.md&lt;/code&gt;. That way,
you can keep your actual README in sync with what the code does right now, but
have the final one that you want to work towards too.&lt;/p&gt;

&lt;h2&gt;git push origin&lt;/h2&gt;

&lt;p&gt;Now that we have a file, we can push it up to GitHub. A few clicks on the web,
a &lt;code&gt;git add remote&lt;/code&gt; and &lt;code&gt;git push -u origin master&lt;/code&gt; and we&amp;#8217;re off to the races.&lt;/p&gt;

&lt;h2&gt;mvim Gemfile &amp;amp;&amp;amp; bundle&lt;/h2&gt;

&lt;p&gt;Next up we talked about Bundler, Gemfiles, and managing gems. I talked about
the ability to run your own private gem server for internal gems, and how
easy it is to build and publish a gem.&lt;/p&gt;

&lt;h2&gt;mkdir spec&lt;/h2&gt;

&lt;p&gt;I then generally type this. I would be lying to you if I told you that I do TDD
100% of the time. Sometimes, I get lazy. But I try to. And since testing is such
a huge part of Ruby culture, and we have world-class testing tools, this is
where I started.&lt;/p&gt;

&lt;p&gt;I wrote specs for a model class called SmsGateway. This class would handle
sending a message to a phone via Twilio. I was able to show off rspec, talk
about DSLs, mocking, and TDD.&lt;/p&gt;

&lt;h2&gt;mvim something.rb&lt;/h2&gt;

&lt;p&gt;In this case it&amp;#8217;s sms_gateway.rb, but you know what I mean. Write some code,
&lt;code&gt;rspec spec/sms_gateway_spec.rb&lt;/code&gt;, repeat. Red, Green, Refactor. Wheee!&lt;/p&gt;

&lt;h2&gt;mvim .travis.yml&lt;/h2&gt;

&lt;p&gt;I wanted to show Travis off, so in my demo I did this before implementing the
gateway class, but normally I&amp;#8217;d do this after the first spec passes.
Continuous Integration and even Continuous Deployment are awesome. Travis
makes it super easy.&lt;/p&gt;

&lt;h2&gt;Sign up for external services&lt;/h2&gt;

&lt;p&gt;I went over to Twilio&amp;#8217;s site, registered a new account, and got my credentials.
I used their docs to figure out where to put them, and how to get it all going
inside my gateway class (I just mocked it out before), and talked about how
needing to Google for docs is a weakness of Ruby.&lt;/p&gt;

&lt;h2&gt;heroku create &amp;amp;&amp;amp; git push heroku master&lt;/h2&gt;

&lt;p&gt;Then I showed them how to get going with Heroku, and how easy it was to start
giving them hundreds of dollars per month when you need to scale. .NET people
are used to paying for everything. ;)&lt;/p&gt;

&lt;p&gt;I also showed off one of my latest projects, which is an IRC bot that lets me
deploy rstat.us into production. I have some serious Hubot envy. :D&lt;/p&gt;

&lt;h2&gt;&amp;#8230; repeat!&lt;/h2&gt;

&lt;p&gt;I&amp;#8217;d be lying if I said it worked the first time, I accidentally made a loop
where the app texted itself. Whoops! But that was cool, and showing off my
debugging process (I&amp;#8217;m a &lt;code&gt;puts/throw params&lt;/code&gt; debugger) was fun, as well. After
realizing what I did wrong, we had the app working.&lt;/p&gt;

&lt;h2&gt;It&amp;#8217;s not quite perfect&lt;/h2&gt;

&lt;p&gt;This dev process isn&amp;#8217;t perfect yet. Nothing ever is. I&amp;#8217;m always trying to
improve upon it, but I&amp;#8217;m pretty happy with how quickly I&amp;#8217;m able to turn out
new projects with a reasonable amount of quality. What&amp;#8217;s your workflow? How
does mine suck? &lt;a href="mailto:steve@steveklabnik.com"&gt;Email me&lt;/a&gt;, I&amp;#8217;d love to hear
about it.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=ewbsE-rzUrE:1-bmlrpBByU:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=ewbsE-rzUrE:1-bmlrpBByU:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=ewbsE-rzUrE:1-bmlrpBByU:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=ewbsE-rzUrE:1-bmlrpBByU:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=ewbsE-rzUrE:1-bmlrpBByU:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/ewbsE-rzUrE" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/09/28/real-modern-ruby-development.html</feedburner:origLink></entry>
  
  <entry>
    <title>I’m Deleting My Facebook Tonight.</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/3OkgmLIaMUc/im-deleting-my-facebook-tonight.html" />
    <updated>2011-09-26T08:34:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/09/26/im-deleting-my-facebook-tonight</id>
    <content type="html">&lt;p&gt;Well, &lt;a href="http://adrianshort.co.uk/2011/09/25/its-the-end-of-the-web-as-we-know-it/"&gt;it&amp;#8217;s the end of the web as we know it&lt;/a&gt;.
I&amp;#8217;d already been thinking about this all weekend, and last night, I decided. I
just can&amp;#8217;t deal with Facebook&amp;#8217;s crazy privacy stuff anymore. I mean, I already
basically &lt;a href="http://rstat.us"&gt;forked Twitter&lt;/a&gt; over their ToS, and Facebook has been
a lot more evil for a lot longer. Frictionless sharing is pretty much the last
straw.&lt;/p&gt;

&lt;p&gt;I&amp;#8217;ll be using this as an excuse to keep helping out with the federated web.
There&amp;#8217;s a lot of cool stuff in this area, but it needs help. If you&amp;#8217;re a
developer, consider helping out with the &lt;a href="https://github.com/LockerProject/Locker"&gt;Locker Project&lt;/a&gt;
or &lt;a href="https://github.com/homesteading"&gt;the Homesteading Project&lt;/a&gt;. The only way
that we can prevent people from becoming digial sharecroppers is by helping them
to &amp;#8216;own their own land.&amp;#8217;&lt;/p&gt;

&lt;p&gt;If we&amp;#8217;re Facebook friends, you can always find out how to reach me at
&lt;a href="http://steveklabnik.com"&gt;http://steveklabnik.com&lt;/a&gt;. Please be careful, and
consider if Facebook&amp;#8217;s privacy settings are really worth it to you. They may be,
and they may not. I&amp;#8217;m under no illusions that the vast majority of people will
give up Facebook, but I figured I&amp;#8217;d warn you anyways.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=3OkgmLIaMUc:3m_ZqT2iagg:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=3OkgmLIaMUc:3m_ZqT2iagg:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=3OkgmLIaMUc:3m_ZqT2iagg:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=3OkgmLIaMUc:3m_ZqT2iagg:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=3OkgmLIaMUc:3m_ZqT2iagg:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/3OkgmLIaMUc" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/09/26/im-deleting-my-facebook-tonight.html</feedburner:origLink></entry>
  
  <entry>
    <title>More rstat.us Refactoring</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/CbrFXU8ArkM/more-rstat-dot-us-refactoring.html" />
    <updated>2011-09-23T17:03:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/09/23/more-rstat-dot-us-refactoring</id>
    <content type="html">&lt;p&gt;Hey everyone! I just wanted to share One More Thing with you about this rstat.us
refactoring.&lt;/p&gt;

&lt;p&gt;The main thrust of the last article I posted was to show you a technique for
extracting a class, getting it under some kind of test, and then refactoring it
a bit. Refactoring is always an iterative process, and Ryan Bates from the
always awesome &lt;a href="http://railscasts.com"&gt;Railscasts&lt;/a&gt; asked me why I made the
Salmon class into a module, especially given my recent &lt;a href="http://blog.steveklabnik.com/2011/09/06/the-secret-to-rails-oo-design.html"&gt;rant&lt;/a&gt;
against modules. The answer was, &amp;#8216;because it&amp;#8217;s simpler, and the first thing
I thought of.&amp;#8217; He shared with me an alternate implementation that I like too,
and I wanted to share with you. Check it:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/salmon_notifier.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;span class=’line’&gt;29&lt;/span&gt;
&lt;span class=’line’&gt;30&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SalmonNotifier&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;deliver&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;follow&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;deliver&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="vi"&gt;@feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;unfollow&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;deliver&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="vi"&gt;@feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;protected&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;deliver&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;send_envelope_to_salmon_endpoint&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_envelope_to_salmon_endpoint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;This follows a more OO style, and is a bit more well-factored. Here&amp;#8217;s his
description of what he did:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;1. Switched to a class and gave it a name that is a noun (maybe name&lt;br/&gt;should be different though).&lt;br/&gt;2. Moved common method params into instance variables.&lt;br/&gt;3. This simplified the mention/follow/unfollow methods enough to be on one line.&lt;br/&gt;4. Renamed &amp;#8220;send_to_salmon_endpoint&amp;#8221; to &amp;#8220;deliver&amp;#8221; because it feels&lt;br/&gt;nicer, the &amp;#8220;salmon endpoint&amp;#8221; can be assumed due to the name of the&lt;br/&gt;class. I generally don&amp;#8217;t like to put the class name in the method&lt;br/&gt;name.&lt;br/&gt;5. Extracted commented out into its own method with the same name. I&lt;br/&gt;don&amp;#8217;t know if this is really necessary though (same reason as above).&lt;/p&gt;&lt;p&gt;The only thing that bothers me now is the constant access of&lt;br/&gt;@user.author and @feed.author. This makes me think it should be&lt;br/&gt;interacting directly with authors. However you still need access to&lt;br/&gt;@user.to_rsa_keypair but maybe that method could be moved elsewhere&lt;br/&gt;more accessible.&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;All of these changes are pretty good. Ryan&amp;#8217;s suggestions for moving forward are
pretty good, as well, but I&amp;#8217;d add one more thing: we&amp;#8217;re starting to collect a
bunch of methods all related to delivering more generic HTTP requests in the
protected section. This also might be worth pulling out, too.  Protected/private
in general is a minor smell that indicates there&amp;#8217;s code being used multiple
times that&amp;#8217;s not part of the main objective of the class.  It might not be worth
it yet, but then again, it might. Speaking of protected methods, you might
wonder why I ended up mocking out my protected method in the last post, as well.
There are no more tests that actually test the method is working properly.  This
is true, and it&amp;#8217;s because I was leading into thinking of something like this.
Mocked tests are almost always unit tests, and two methods are two separate
units, so I had just ended up doing it out of habit. This further shows that
maybe an extraction of another class is worthwhile.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=CbrFXU8ArkM:5GosI-NPszs:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=CbrFXU8ArkM:5GosI-NPszs:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=CbrFXU8ArkM:5GosI-NPszs:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=CbrFXU8ArkM:5GosI-NPszs:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=CbrFXU8ArkM:5GosI-NPszs:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/CbrFXU8ArkM" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/09/23/more-rstat-dot-us-refactoring.html</feedburner:origLink></entry>
  
  <entry>
    <title>Extracting Domain Models: A Practical Example</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/2AE4DXqTYug/extracting-domain-models-a-practical-example.html" />
    <updated>2011-09-22T10:25:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/09/22/extracting-domain-models-a-practical-example</id>
    <content type="html">&lt;p&gt;Hey everyone! We&amp;#8217;ve been doing a lot of refactoring on rstat.us lately, and I
wanted to share with you a refactoring that I did. It&amp;#8217;s a real-world example
of doing the domain models concept that I&amp;#8217;ve been talking about lately.&lt;/p&gt;

&lt;h2&gt;Step one: check the tests&lt;/h2&gt;

&lt;blockquote&gt;&lt;p&gt;I don&amp;#8217;t know how much more emphasized step 1 of refactoring could be: don&amp;#8217;t touch anything that doesn&amp;#8217;t have coverage. Otherwise, you&amp;#8217;re not refactoring; you&amp;#8217;re just changing shit.
- Hamlet D&amp;#8217;Arcy&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;One of the best reasons to extract extra domain models is that they&amp;#8217;re often
much easier to test. They have less dependencies, less code, and are much
simpler than the Mega Models that happen if you have a 1-1 model to table
ratio.&lt;/p&gt;

&lt;p&gt;Let&amp;#8217;s check out the code. It&amp;#8217;s in our User model:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/user.rb &lt;/span&gt;&lt;a href=’https://github.com/hotsh/rstat.us/blob/362cb38031/app/models/user.rb#L209’&gt;link&lt;/a&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send an update to a remote user as a Salmon notification&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_mention_notification&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;base_uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_uri&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;You&amp;#8217;re probably saying &amp;#8220;this is pretty reasonable.&amp;#8221; Prepare to get shocked&amp;#8230;&lt;/p&gt;

&lt;p&gt;This code has very little to do with the user, other than using some of the
User&amp;#8217;s attributes. This really could be factored out into a domain object
whose job it is to push Salmon notifications. But first, let&amp;#8217;s see if we can get
some tests in place so we know &lt;em&gt;everything&lt;/em&gt; isn&amp;#8217;t broken. Examining this method,
we need two things: an &lt;code&gt;update_id&lt;/code&gt; and a &lt;code&gt;feed_id&lt;/code&gt;. Here&amp;#8217;s my first stab at an
integration test:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;test/models/notify_via_salmon_test.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;salmon update&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;integration regression test&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;update&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;double&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_xml&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;xml&amp;gt;&amp;lt;/xml&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;double&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:port&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;9001&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:path&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Ostatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:parse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mock&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_mention_notification&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;This is an integration test, we&amp;#8217;re obviously testing stuff with a ton of models.
After running &lt;code&gt;ruby test/models/notify_via_salmon.rb&lt;/code&gt; about a zillion times, I
ended up with this running test:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;test/models/notify_via_salmon.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;span class=’line’&gt;29&lt;/span&gt;
&lt;span class=’line’&gt;30&lt;/span&gt;
&lt;span class=’line’&gt;31&lt;/span&gt;
&lt;span class=’line’&gt;32&lt;/span&gt;
&lt;span class=’line’&gt;33&lt;/span&gt;
&lt;span class=’line’&gt;34&lt;/span&gt;
&lt;span class=’line’&gt;35&lt;/span&gt;
&lt;span class=’line’&gt;36&lt;/span&gt;
&lt;span class=’line’&gt;37&lt;/span&gt;
&lt;span class=’line’&gt;38&lt;/span&gt;
&lt;span class=’line’&gt;39&lt;/span&gt;
&lt;span class=’line’&gt;40&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;minitest/autorun&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rspec/mocks&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;mongo_mapper&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;whatlanguage&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;MongoMapper&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Mongo&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;MongoMapper&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;database&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rstatus-test&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/feed&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/update&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/author&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/authorization&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="vg"&gt;$:&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unshift&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lib&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/user&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ostatus&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;salmon update&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="ss"&gt;:each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="ss"&gt;:destroy&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;RSpec&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Mocks&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;integration regression test&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;author&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:username&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;steve&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;feed&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;update&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:feed_id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:author_id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:text&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hello world&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;double&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_xml&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;xml&amp;gt;&amp;lt;/xml&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;double&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:port&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;9001&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:path&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:parse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mock&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_mention_notification&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Holy. Fuck. Seriously. Let me just quote &lt;a href="http://avdi.org"&gt;Avdi Grimm&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Mocks, and to some degree RSpec, are like the Hydrogen Peroxide of programming: they fizz up where they encounter subtle technical debt.&lt;/p&gt;&lt;footer&gt;&lt;strong&gt;Avdi Grimm,&lt;/strong&gt;&lt;cite&gt;&lt;a href=’http://avdi.org/devblog/2011/04/07/rspec-is-for-the-literate/’&gt;&amp;#8220;Rspec Is for the Literate&amp;#8221;&lt;/a&gt;&lt;/cite&gt;&lt;/footer&gt;&lt;/blockquote&gt;


&lt;p&gt;This test class is insane. It runs faster than many people&amp;#8217;s integration tests,
clocking in at about 0.4 seconds. But that&amp;#8217;s still an order of magnitude slower
than I&amp;#8217;d like. A suite with 200 tests would still take over a minute. Also, look
at all this junk that we have to do for setup.&lt;/p&gt;

&lt;p&gt;All of this pain and effort doesn&amp;#8217;t mean that testing sucks: it means that our
implementation is terrible. So let&amp;#8217;s use that to guide us. We&amp;#8217;ll try to fix this
code by eliminating all of this junk.&lt;/p&gt;

&lt;h2&gt;Step two: simple extraction&lt;/h2&gt;

&lt;p&gt;First, let&amp;#8217;s extract this out to a domain model. Here&amp;#8217;s the new code:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/user.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send an update to a remote user as a Salmon notification&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_mention_notification&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;




&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/notify_via_salmon.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;NotifyViaSalmon&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;extend&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;base_uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_uri&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Now, when we run the test (via &lt;code&gt;ruby test/models/notify_via_salmon_test.rb&lt;/code&gt;) we
see an error:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/notify_via_salmon.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="no"&gt;Error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;test_0001_integration_regression_test&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;SalmonUpdateSpec&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;NameError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;undefined&lt;/span&gt; &lt;span class="n"&gt;local&lt;/span&gt; &lt;span class="n"&gt;variable&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="nb"&gt;method&lt;/span&gt; &lt;span class="sb"&gt;`author&amp;#39; for NotifyViaSalmon:Module&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="sb"&gt;    /Users/steveklabnik/src/rstat.us/app/models/notify_via_salmon.rb:8:in `&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;This is a form of Lean On The Compiler. This test is now failing because it&amp;#8217;s
relying on stuff that used to be internal to the User, and we don&amp;#8217;t have that
stuff now. After doing this a few times, we&amp;#8217;re left with this:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/user.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send an update to a remote user as a Salmon notification&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_mention_notification&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;




&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/notify_via_salmon.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;NotifyViaSalmon&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;extend&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;u&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;base_uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_uri&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Okay. Now we&amp;#8217;re cooking. We have a test that&amp;#8217;s isolated, yet still does what we
thought it did before.&lt;/p&gt;

&lt;h2&gt;Step three: break dependencies&lt;/h2&gt;

&lt;p&gt;Next step: let&amp;#8217;s break the hard dependency this method has on both Feed and
Update. We can do this by moving the finds up into the User method instead of
keeping them in the mention method:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/user.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send an update to a remote user as a Salmon notification&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_mention_notification&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;update&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;




&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/notify_via_salmon.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;NotifyViaSalmon&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;extend&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;base_uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_uri&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Okay. Tests passing. Sweet. Now we can try testing &lt;em&gt;just&lt;/em&gt; the mention method.
Let&amp;#8217;s try it by killing most of that crap that was in our test:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;test/models/notify_via_salmon_test.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;minitest/autorun&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rspec/mocks&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/notify_via_salmon&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;salmon update&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="ss"&gt;:each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;RSpec&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Mocks&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;integration regression test&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Let&amp;#8217;s try running this and seeing what happens:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;test/models/notify_via_salmon_test.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;ruby&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;notify_via_salmon_test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rb&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;Loaded&lt;/span&gt; &lt;span class="n"&gt;suite&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;notify_via_salmon_test&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;Started&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;E&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;Finished&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mo"&gt;000&lt;/span&gt;&lt;span class="mi"&gt;992&lt;/span&gt; &lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="no"&gt;Error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;test_0001_integration_regression_test&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;SalmonUpdateSpec&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;RSpec&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Mocks&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;MockExpectationError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Stub&lt;/span&gt; &lt;span class="n"&gt;received&lt;/span&gt; &lt;span class="n"&gt;unexpected&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;First of all, daaaaamn. 0.001 seconds. Nice. Secondly, okay, we are getting some
messages sent to our stubs. Let&amp;#8217;s flesh them out to make things pass:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;test/models/notify_via_salmon_test.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;minitest/autorun&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rspec/mocks&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ostatus&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/notify_via_salmon&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;salmon update&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="ss"&gt;:each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;RSpec&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Mocks&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;integration regression test&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:domain&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;:to_rsa_keypair&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;update&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:salmon_url&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_xml&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:port&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:path&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:parse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Okay! Note how similar this looks to the previous test. We&amp;#8217;re still mocking a
bunch of &amp;#8216;external&amp;#8217; stuff. But other than that, our test is pretty simple: we
make three stubs, and we call our mention method.&lt;/p&gt;

&lt;h3&gt;Step four: repeat&lt;/h3&gt;

&lt;p&gt;We could do some more work on this method. There are a few things that are
a bit smelly: the nested stub of User is not great. The fact that we&amp;#8217;re stubbing
out three external dependencies isn&amp;#8217;t great. But before we get to that, let&amp;#8217;s
check out another method that looks similar:
&lt;code&gt;send_{follow,unfollow}_notification&lt;/code&gt;. Here&amp;#8217;s some code:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/user.rb &lt;/span&gt;&lt;a href=’https://github.com/hotsh/rstat.us/blob/362cb38031/app/models/user.rb#L167’&gt;link&lt;/a&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;span class=’line’&gt;29&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send Salmon notification so that the remote user&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# knows this user is following them&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_follow_notification&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send Salmon notification so that the remote user&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# knows this user has stopped following them&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_unfollow_notification&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Look familliar? Yep! 90% the same code! We&amp;#8217;ll do the same process to these
methods, just like the other one. Check out this code and test:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/user.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send Salmon notification so that the remote user&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# knows this user is following them&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_follow_notification&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send Salmon notification so that the remote user&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# knows this user has stopped following them&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_unfollow_notification&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;# Send an update to a remote user as a Salmon notification&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_mention_notification&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;to_feed_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;update&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="ss"&gt;:id&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;update_id&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;




&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/notify_via_salmon.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;span class=’line’&gt;29&lt;/span&gt;
&lt;span class=’line’&gt;30&lt;/span&gt;
&lt;span class=’line’&gt;31&lt;/span&gt;
&lt;span class=’line’&gt;32&lt;/span&gt;
&lt;span class=’line’&gt;33&lt;/span&gt;
&lt;span class=’line’&gt;34&lt;/span&gt;
&lt;span class=’line’&gt;35&lt;/span&gt;
&lt;span class=’line’&gt;36&lt;/span&gt;
&lt;span class=’line’&gt;37&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;NotifyViaSalmon&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;extend&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;base_uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_uri&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;




&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;test/models/notify_via_salmon_test.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;span class=’line’&gt;29&lt;/span&gt;
&lt;span class=’line’&gt;30&lt;/span&gt;
&lt;span class=’line’&gt;31&lt;/span&gt;
&lt;span class=’line’&gt;32&lt;/span&gt;
&lt;span class=’line’&gt;33&lt;/span&gt;
&lt;span class=’line’&gt;34&lt;/span&gt;
&lt;span class=’line’&gt;35&lt;/span&gt;
&lt;span class=’line’&gt;36&lt;/span&gt;
&lt;span class=’line’&gt;37&lt;/span&gt;
&lt;span class=’line’&gt;38&lt;/span&gt;
&lt;span class=’line’&gt;39&lt;/span&gt;
&lt;span class=’line’&gt;40&lt;/span&gt;
&lt;span class=’line’&gt;41&lt;/span&gt;
&lt;span class=’line’&gt;42&lt;/span&gt;
&lt;span class=’line’&gt;43&lt;/span&gt;
&lt;span class=’line’&gt;44&lt;/span&gt;
&lt;span class=’line’&gt;45&lt;/span&gt;
&lt;span class=’line’&gt;46&lt;/span&gt;
&lt;span class=’line’&gt;47&lt;/span&gt;
&lt;span class=’line’&gt;48&lt;/span&gt;
&lt;span class=’line’&gt;49&lt;/span&gt;
&lt;span class=’line’&gt;50&lt;/span&gt;
&lt;span class=’line’&gt;51&lt;/span&gt;
&lt;span class=’line’&gt;52&lt;/span&gt;
&lt;span class=’line’&gt;53&lt;/span&gt;
&lt;span class=’line’&gt;54&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;minitest/autorun&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rspec/mocks&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ostatus&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/notify_via_salmon&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="ss"&gt;:each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;RSpec&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Mocks&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.mention&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:domain&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;:to_rsa_keypair&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;update&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:salmon_url&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_xml&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:port&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:path&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:parse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.follow&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:domain&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;:to_rsa_keypair&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:salmon_url&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_xml&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:from_follow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:port&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:path&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:parse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.unfollow&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:domain&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;:to_rsa_keypair&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:salmon_url&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_xml&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:from_unfollow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:host&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:port&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:path&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:parse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:new&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Now we can see some of these patterns start to emerge, eh? All of this stuff is
starting to come together. Let&amp;#8217;s get rid of the URI and Net::HTTP stuff, as it&amp;#8217;s
just straight up identical in all three. Pretty basic Extract Method:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;app/models/notify_via_salmon.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;span class=’line’&gt;29&lt;/span&gt;
&lt;span class=’line’&gt;30&lt;/span&gt;
&lt;span class=’line’&gt;31&lt;/span&gt;
&lt;span class=’line’&gt;32&lt;/span&gt;
&lt;span class=’line’&gt;33&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;NotifyViaSalmon&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;extend&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;base_uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_uri&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;send_to_salmon_endpoint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;send_to_salmon_endpoint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_atom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;send_to_salmon_endpoint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_rsa_keypair&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;salmon_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;protected&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send_to_salmon_endpoint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;keypair&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;envelope&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_xml&lt;/span&gt; &lt;span class="n"&gt;keypair&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;# Send envelope to Author&amp;#39;s Salmon endpoint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envelope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;application/magic-envelope+xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;We run our tests, it still all works. Now we can just mock out the endpoint
method, and all of our tests on the individual methods become much, much simpler:&lt;/p&gt;

&lt;figure role=code&gt;&lt;figcaption&gt;&lt;span&gt;test/models/notify_via_salmon_test.rb&lt;/span&gt;&lt;/figcaption&gt;&lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;span class=’line’&gt;29&lt;/span&gt;
&lt;span class=’line’&gt;30&lt;/span&gt;
&lt;span class=’line’&gt;31&lt;/span&gt;
&lt;span class=’line’&gt;32&lt;/span&gt;
&lt;span class=’line’&gt;33&lt;/span&gt;
&lt;span class=’line’&gt;34&lt;/span&gt;
&lt;span class=’line’&gt;35&lt;/span&gt;
&lt;span class=’line’&gt;36&lt;/span&gt;
&lt;span class=’line’&gt;37&lt;/span&gt;
&lt;span class=’line’&gt;38&lt;/span&gt;
&lt;span class=’line’&gt;39&lt;/span&gt;
&lt;span class=’line’&gt;40&lt;/span&gt;
&lt;span class=’line’&gt;41&lt;/span&gt;
&lt;span class=’line’&gt;42&lt;/span&gt;
&lt;span class=’line’&gt;43&lt;/span&gt;
&lt;span class=’line’&gt;44&lt;/span&gt;
&lt;span class=’line’&gt;45&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;minitest/autorun&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rspec/mocks&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ostatus&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;require_relative&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../app/models/notify_via_salmon&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="ss"&gt;:each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;RSpec&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Mocks&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.mention&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:domain&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;:to_rsa_keypair&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;update&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:salmon_url&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:send_to_salmon_endpoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mention&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.follow&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:domain&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;:to_rsa_keypair&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:salmon_url&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_xml&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:from_follow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:send_to_salmon_endpoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;follow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.unfollow&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:domain&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;:to_rsa_keypair&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;feed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:author&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:salmon_url&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:to_atom&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;salmon&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_xml&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;OStatus&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Salmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:from_unfollow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;and_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;salmon&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;should_receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:send_to_salmon_endpoint&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;NotifyViaSalmon&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unfollow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;feed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;We&amp;#8217;ve managed to get rid of all of the mocking of the URI stuff. It&amp;#8217;s all
details now. We also have great information about what is actually needed for
this test: we know exactly what our objects expect the caller to pass. We&amp;#8217;re
only depending on ourselves and some external libraries. Our tests are fast.
Overall, I&amp;#8217;m feeling much better about this code than I was before.&lt;/p&gt;

&lt;h2&gt;In conclusion&lt;/h2&gt;

&lt;p&gt;I hope you&amp;#8217;ll take a few things away from this post.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Start with tests first!&lt;/strong&gt; If you don&amp;#8217;t do this, it&amp;#8217;s very easy to introduce
simple errors. Don&amp;#8217;t be that guy. You know, the one that has to make &lt;a href="https://github.com/hotsh/rstat.us/pull/398/files"&gt;pull requests like this&amp;#8230;&lt;/a&gt;
I suck.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Don&amp;#8217;t be afraid to change the tests!&lt;/strong&gt; As soon as you&amp;#8217;ve verified that you&amp;#8217;ve
transcribed the code correctly, don&amp;#8217;t be afraid to just nuke things and start
again. Especially if you have integration level tests that confirm that your
features actually &lt;em&gt;work&lt;/em&gt;, your unit tests are expendable. If they&amp;#8217;re not useful,
kill them!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Mock like a motherfucker.&lt;/strong&gt; When done correctly, mocks allow you to help
design your code better, make your tests fast, and truly isolate the unit under
test. It&amp;#8217;s pretty much all upside, unless you suck at them.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Extract, extract, extract!&lt;/strong&gt; Adele Goldberg once said, “In Smalltalk,
everything happens somewhere else.” Make tons of little methods. They help
to provide seams that are useful for testing. Smaller methods are also easier to
understand.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Refactoring is a marathon.&lt;/strong&gt; Even with all this work, this code isn&amp;#8217;t the best.
The tests could even use a little TLC. But it&amp;#8217;s still better than it was before.
Those who ship, win. Make things a little better, &lt;code&gt;git commit &amp;amp;&amp;amp; git push&lt;/code&gt;, repeat.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=2AE4DXqTYug:Da4BxDnsM3c:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=2AE4DXqTYug:Da4BxDnsM3c:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=2AE4DXqTYug:Da4BxDnsM3c:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=2AE4DXqTYug:Da4BxDnsM3c:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=2AE4DXqTYug:Da4BxDnsM3c:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/2AE4DXqTYug" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/09/22/extracting-domain-models-a-practical-example.html</feedburner:origLink></entry>
  
  <entry>
    <title>Better Ruby Presenters</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/wKPzrXy2sJA/better-ruby-presenters.html" />
    <updated>2011-09-09T12:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/09/09/better-ruby-presenters</id>
    <content type="html">&lt;p&gt;My &lt;a href="http://blog.steveklabnik.com/2011/09/06/the-secret-to-rails-oo-design.html"&gt;last blog post&lt;/a&gt; caused a bit
of a stir in some circles. I got a bunch of emails. Apparently, I need to expand
on a few things. So here we go. Let&amp;#8217;s rap about the Presenter pattern, shall we?&lt;/p&gt;

&lt;h2&gt;No seriously, helpers suck&lt;/h2&gt;

&lt;blockquote&gt;&lt;p&gt;In Ruby, everything is an object. Every bit of information and code can be given their own properties and actions.&lt;/p&gt;&lt;footer&gt;&lt;strong&gt;ruby-lang: about&lt;/strong&gt;&lt;cite&gt;&lt;a href=’http://www.ruby-lang.org/en/about/’&gt;www.ruby-lang.org/en/about/&amp;hellip;&lt;/a&gt;&lt;/cite&gt;&lt;/footer&gt;&lt;/blockquote&gt;


&lt;p&gt;&amp;#8230; except helpers. Why is it in Ruby that everything is an object, even
integers, yet as soon as we need to format a date, we all turn into Dijkstra and
bust out structured programming? Actually, come to think of it, Dijkstra
wouldn&amp;#8217;t even write any code, because it&amp;#8217;s beneath him, but you get the idea.
(if you don&amp;#8217;t get this, it&amp;#8217;s a joke. About proofs, telescopes, and CS&amp;#8230;)
Helpers are like a compliment that you don&amp;#8217;t want to give, but feel obligated
to: &amp;#8220;Yeah, I mean, well, you tried, and that&amp;#8217;s what counts, right?&amp;#8221;&lt;/p&gt;

&lt;p&gt;This is the topic of a future post, but when programming in a langauge, you want
to work with its primary methods of abstraction. In Ruby, that&amp;#8217;s objects, and
there&amp;#8217;s a good reason for that: functions don&amp;#8217;t provide a sufficient amount of
power to tackle hard problems. I don&amp;#8217;t want to get into this either, but there&amp;#8217;s
a reason that objects exist, and that nobody&amp;#8217;s making procedural languages
anymore.  No biggie. C has a special place in my heart.&lt;/p&gt;

&lt;p&gt;But I digress: objects &gt; functions. At least in the context of getting stuff
done in Ruby. This pretty much applies to most of the rest of the points in this
post, so just keep that in the back of your brain.&lt;/p&gt;

&lt;h2&gt;Why not a class method?&lt;/h2&gt;

&lt;p&gt;Well, first of all, &lt;a href="http://nicksda.apotomo.de/2011/07/are-class-methods-evil/"&gt;class methods also suck&lt;/a&gt;. Here&amp;#8217;s the
issue: Can you tell me the difference between these two methods?&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;foo&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="s2"&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bar&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;foo&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="s2"&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;foo&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;Bar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;foo&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Yep, that&amp;#8217;s right. You can see it clearly from the last two lines: class methods
are functions that happen to be namespaced. That means they&amp;#8217;re slightly better,
but really, &lt;code&gt;DictionaryPresenter.as_dictionary(something)&lt;/code&gt; might as well just be
a helper. At least &lt;code&gt;as_dictionary(something)&lt;/code&gt; is shorter.&lt;/p&gt;

&lt;p&gt;Here&amp;#8217;s another reason: I didn&amp;#8217;t make that method be a class method, even though
there was no state, because a really real presenter (I mean, that was a real
world example, but&amp;#8230;) generally works a little different. Usually, I make
presenters that actually stand in for the objects they&amp;#8217;re presenting. Check
this out. Here&amp;#8217;s the presenter I showed you:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DictionaryPresenter&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@collection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;collection&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;as_dictionary&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;dictionary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Z&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;({})&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@collection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;dictionary&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;p&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;dictionary&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;The real-world presenter that I used this for looked like this:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DictionaryPresenter&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;Enumerable&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@dictionary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Z&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;({})&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="vi"&gt;@dictionary&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;p&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;each&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@dictionary&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;&amp;#8230; or close to this. There was an &amp;#8216;other&amp;#8217; category, and a few other things&amp;#8230;
but you get the idea. Now, instead of this:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="vi"&gt;@posts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;DictionaryPresenter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;as_dictionary&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;You do this:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="vi"&gt;@posts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;DictionaryPresenter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;And the presenter actually stands in for the hash. A subtle but important
difference. This gives you more options, because you have a real, live object
instead of just some random processing. With this simplistic presenter, you
might not see a huge benefit, but often, you&amp;#8217;ll want something a bit more
complicated. And since this was what I had in my head, I didn&amp;#8217;t make
&lt;code&gt;as_dictionary&lt;/code&gt; be a static method.&lt;/p&gt;

&lt;p&gt;Oh, and presenters that decorate a single object rather than a collection
often implement &lt;code&gt;method_missing&lt;/code&gt;, so that you only &lt;em&gt;add&lt;/em&gt; methods rather than
hide most of them. Some don&amp;#8217;t. It depends.&lt;/p&gt;

&lt;h2&gt;Blocks vs. Policy&lt;/h2&gt;

&lt;p&gt;I also showed off a Ruby version of a design pattern known as the Policy
pattern, or sometimes the Strategy pattern. Turns out that Policy is often
a bit heavyweight for Ruby, especially in an example like this, so I wanted
to show you an alternate version of it, taking advantage of a Ruby feature:
blocks.&lt;/p&gt;

&lt;p&gt;For reference, the old code, put into the new code:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DictionaryPresenter&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;Enumerable&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;policy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@dictionary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Z&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;({})&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="vi"&gt;@dictionary&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;policy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;category_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;p&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;each&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@dictionary&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserCategorizationPolicy&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;category_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;We could use blocks instead:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DictionaryPresenter&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;Enumerable&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@dictionary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Z&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;({})&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="vi"&gt;@dictionary&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;p&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;each&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@dictionary&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;DictionaryPresenter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;While this is shorter, and a bit more Rubyish, it also means that we lose the
&lt;a href="http://en.wikipedia.org/wiki/Reification_(computer_science"&gt;reification&lt;/a&gt;) of
our concept of a policy. While this is &lt;em&gt;shorter&lt;/em&gt;, I find it more
confusing. Why am I giving this one line block to the presenter? It&amp;#8217;s not really
clear to me. And I can&amp;#8217;t give a better name to item&amp;#8230; and if I want to change
the policy, it has to be done in every place we use the presenter&amp;#8230;&lt;/p&gt;

&lt;p&gt;This does get to the root of another thing that will end up being a follow-up:
What&amp;#8217;s the difference between closures and objects? If you don&amp;#8217;t know, maybe
this will get you thinking:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="c1"&gt;#ugh, this is slightly odd, thanks Ruby!&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;proc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;blk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;block_given?&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;blk&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;call&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;else&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="nb"&gt;proc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;call&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="nb"&gt;proc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Proc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;a proc!&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyProc&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;call&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;an object!&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;my_proc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;MyProc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;apply&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;a block!&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;apply&lt;/span&gt; &lt;span class="nb"&gt;proc&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;apply&lt;/span&gt; &lt;span class="n"&gt;my_proc&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Chew on that a while.&lt;/p&gt;

&lt;h2&gt;This is too verbose&lt;/h2&gt;

&lt;p&gt;Absolutely. &lt;code&gt;DictionaryPresenter.new(PostCategorizationPolicy, Post.all).as_dictionary&lt;/code&gt;
is too long. 100% there. Good thing that I&amp;#8217;d &lt;em&gt;actually&lt;/em&gt; write this:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;Dictionary&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ByTitle&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;I switched the arguments around, because it reads better. When writing blog
posts, you have to balance writing code samples that explain what you&amp;#8217;re
trying to say, and ones that are &amp;#8216;real.&amp;#8217; I tend to be a bit more verbose with
things like this, because it&amp;#8217;s easier for someone who just jumps in to remember
what all the parts are&amp;#8230; then again, by &lt;em&gt;not&lt;/em&gt; showing the &amp;#8216;real code,&amp;#8217; people
might end up implementing the crappy, verbose version. It&amp;#8217;s always a trade-off,
and I may or may not make the right choice. It happens.&lt;/p&gt;

&lt;p&gt;And yes, even earlier in this blog post: I said &lt;code&gt;DictionaryPresenter&lt;/code&gt; and I&amp;#8217;d
really just say &lt;code&gt;Dictionary&lt;/code&gt;.&lt;/p&gt;

&lt;h2&gt;Where does all of this go?&lt;/h2&gt;

&lt;p&gt;You&amp;#8217;ve got two options, and only one of them is good: You should make a
directory in app for your presenters. In this case, I&amp;#8217;d be running
&lt;code&gt;touch app/presenters/dictionary.rb&lt;/code&gt; pretty quick. The other case is to
put things in lib. This whole debacle uncovers something that @avdi went
on a rant about over the last few days: models don&amp;#8217;t have to inherit from
anything. Here&amp;#8217;s what Wikipedia says about models:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The model manages the behaviour and data of the application domain, responds to requests for information about its state (usually from the view), and responds to instructions to change state (usually from the controller). In event-driven systems, the model notifies observers (usually views) when the information changes so that they can react.&lt;/p&gt;&lt;footer&gt;&lt;strong&gt;MVC&lt;/strong&gt;&lt;cite&gt;&lt;a href=’http://en.wikipedia.org/wiki/Model–view–controller#Concepts’&gt;en.wikipedia.org/wiki/&amp;hellip;&lt;/a&gt;&lt;/cite&gt;&lt;/footer&gt;&lt;/blockquote&gt;


&lt;p&gt;See anything about &amp;#8220;saves stuff to the database?&amp;#8221; Okay, &amp;#8216;manages&amp;#8230; data&amp;#8217; could
be, but the point is, it&amp;#8217;s not &lt;em&gt;required&lt;/em&gt;. Models are the reification of a
concept that exists in your application domain. Persistance is not required for
every concept.&lt;/p&gt;

&lt;p&gt;Therefore, if it relates to your problem domain, it goes in app. If it doesn&amp;#8217;t,
it goes in lib. Something like &lt;code&gt;Dictionary&lt;/code&gt;? Depends on how important you think
it is. It&amp;#8217;s probably pretty important; that&amp;#8217;s why you made it a class.&lt;/p&gt;

&lt;h2&gt;Design Patterns? Are you serious?&lt;/h2&gt;

&lt;p&gt;Yes. Design patterns don&amp;#8217;t suck, Design patterns &lt;em&gt;in Java&lt;/em&gt; suck. I&amp;#8217;m not even
going to start this one here, expect more in this space soon.&lt;/p&gt;

&lt;p&gt;Design patterns are great, and they&amp;#8217;re totally useful in Ruby.&lt;/p&gt;

&lt;h2&gt;In conclusion: A shout-out&lt;/h2&gt;

&lt;p&gt;I hope you&amp;#8217;ve enjoyed this small digression on Presenters. If you&amp;#8217;re gonna use
presenters in your application, I encourage you to write simple ones as simple
Ruby classes, but if they get slightly more complicated, you need to check out
&lt;a href="https://github.com/jcasimir/draper"&gt;Draper&lt;/a&gt; by my buddy Jeff Casimir. It lets
you do stuff like this:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ArticleDecorator&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationDecorator&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;decorates&lt;/span&gt; &lt;span class="ss"&gt;:article&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;author_name&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first_name&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_name&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;article&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ArticleDecorator&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;article&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;author_name&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;There&amp;#8217;s a lot of features to it, so check it out on GitHub. Totally worthwhile.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=wKPzrXy2sJA:zvY7_lIRzXI:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=wKPzrXy2sJA:zvY7_lIRzXI:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=wKPzrXy2sJA:zvY7_lIRzXI:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=wKPzrXy2sJA:zvY7_lIRzXI:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=wKPzrXy2sJA:zvY7_lIRzXI:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/wKPzrXy2sJA" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/09/09/better-ruby-presenters.html</feedburner:origLink></entry>
  
  <entry>
    <title>The Secret to Rails OO Design</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/eHyKEdSN4tw/the-secret-to-rails-oo-design.html" />
    <updated>2011-09-06T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/09/06/the-secret-to-rails-oo-design</id>
    <content type="html">&lt;p&gt;UPDATE: I also have a follow-up &lt;a href="http://blog.steveklabnik.com/2011/09/09/better-ruby-presenters.html"&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I often tell people that I learned Ruby via Rails. This is pretty much the worst
way to do it, but I&amp;#8217;d learned so many programming languages by then that it
didn&amp;#8217;t hinder me too much. The one thing that it did do, however, was give me a
slightly twisted sense of how to properly design the classes needed in a Rails
app. Luckily, I obsessively read other people&amp;#8217;s code, and I&amp;#8217;ve noticed that
there&amp;#8217;s one big thing that is common in most of the code that&amp;#8217;s written by
people whose design chops I respect.&lt;/p&gt;

&lt;p&gt;This particular thing is also seemingly unique to those people. It&amp;#8217;s not
something that people who don&amp;#8217;t write good code attempt, but do badly. It&amp;#8217;s like
a flag, or signal. Now, when I see someone employ this, I instantly think &amp;#8220;they
get it.&amp;#8221; Maybe I&amp;#8217;m giving it too much credit, but this advanced design technique
offers a ton of interconnected benefits throughout your Rails app, is easy to
imploy, and speeds up your tests by an order of magnitude or more.
Unfortunately, to many beginning Rails devs, it&amp;#8217;s non-obvious, but I want &lt;em&gt;you&lt;/em&gt;
to write better code, and so I&amp;#8217;m here to &amp;#8216;break the secret,&amp;#8217; if you will, and
share this awesome, powerful technique with you.&lt;/p&gt;

&lt;p&gt;It&amp;#8217;s called the &amp;#8216;Plain Old Ruby Domain Object.&amp;#8217;&lt;/p&gt;

&lt;p&gt;Yep, that&amp;#8217;s right. A Ruby class that inherets from nothing. It&amp;#8217;s so simple that
it hides in plain sight. Loved by those who&amp;#8217;ve mastered Rails, Plain Old Ruby
Objects, or &amp;#8220;POROs&amp;#8221; as some like to call them, are a hidden weapon against
complexity. Here&amp;#8217;s what I mean. Examine this &amp;#8216;simple&amp;#8217; model:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Post&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;as_dictionary&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;dictionary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Z&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;({})&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;dictionary&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;p&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;dictionary&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;We want to display an index page of all our posts, and do it by first letter.
So we build up a dictionary, and then put our posts in it. I&amp;#8217;m assuming we&amp;#8217;re
not paginating this, so don&amp;#8217;t get caught up in querying for all Posts. The
important thing is the idea: we can now display our posts by title:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’haml’&gt;&lt;div class=’line’&gt;&lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;as_dictionary&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;letter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="nt"&gt;%p&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;letter&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="nt"&gt;%ul&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="n"&gt;list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="nt"&gt;%li&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Sure. And in one way, this code isn&amp;#8217;t &lt;em&gt;bad&lt;/em&gt;. It&amp;#8217;s also not good: We&amp;#8217;ve mixed a
presentational concern into our model, which is supposed to represent buisness
logic. So let&amp;#8217;s fix that, via a Presenter:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DictionaryPresenter&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@collection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;collection&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;as_dictionary&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;dictionary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Z&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;({})&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@collection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;dictionary&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;p&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;dictionary&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;We can use it via &lt;code&gt;DictionaryPresenter.new(Post.all).as_dictionary&lt;/code&gt;. This has
tons of benefits: we&amp;#8217;ve moved presentation logic out of the model. We&amp;#8217;ve
&lt;em&gt;already&lt;/em&gt; added a new feature: any collection can now be displayed as a
dictionary. We can easily write isolated tests for this presenter, and they will
be &lt;em&gt;fast&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;This post isn&amp;#8217;t about the Presenter pattern, though, as much as I love it. This
sort of concept appears in other places, too, &amp;#8220;this domain concept deserves its
own class.&amp;#8221; Before we move to a different example, let&amp;#8217;s expand on this further:
if we want to sort our Posts by title, this class will work, but if we want to
display, say, a User, it won&amp;#8217;t, because Users don&amp;#8217;t have titles. Furthermore,
we&amp;#8217;ll end up with a lot of Posts under &amp;#8220;A,&amp;#8221; because the word &amp;#8220;a&amp;#8221; is pretty
common at the beginning of Posts, so we really want to take the second word in
that case. We can make two kinds of presenters, but now we lose that generality,
and the concept of &amp;#8216;display by dictionary&amp;#8217; has two representations in our system
again. You guessed it: POROs to the rescue!&lt;/p&gt;

&lt;p&gt;Let&amp;#8217;s change our presenter slightly, to also accept an organizational policy
object:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DictionaryPresenter&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;policy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@policy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;policy&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@collection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;collection&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;as_dictionary&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;dictionary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Z&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;({})&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@collection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;dictionary&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="vi"&gt;@policy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;category_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="nb"&gt;p&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;dictionary&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Now, we can inject a policy, and have them be different:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserCategorizationPolicy&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;category_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PostCategorizationPolicy&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;category_for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;starts_with?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;A &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;][&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;else&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Bam!&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="no"&gt;DictionaryPresenter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;PostCategorizationPolicy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;as_dictionary&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Yeah, so that&amp;#8217;s getting a bit long. It happens. :) You can see that now each
concept has one representation in our system. The presenter doesn&amp;#8217;t care how
things are organized, and the policies only dictate how things are organized. In
fact, my names sorta suck, maybe it should be &amp;#8220;UsernamePolicy&amp;#8221; and
&amp;#8220;TitlePolicy&amp;#8221;, actually. We don&amp;#8217;t even care what class they are!&lt;/p&gt;

&lt;p&gt;It goes further than that in other directions, too. Combining the flexibility of
Ruby with one of my favorite patterns from &amp;#8220;Working Effectively with Legacy
Code,&amp;#8221; we can take complex computations and turn them into objects. Look at this
code:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Quote&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="c1"&gt;#&amp;lt;snip&amp;gt;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;pretty_turnaround&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;turnaround&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;nil?&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;purchased_at&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;purchased_at&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;days_from_today&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;purchased_at&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;floor&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;else&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;days_from_today&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;turnaround&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;turnaround&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;elsif&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sun&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%A %d %B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; (&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;days_from_today&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; business days from today)&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Yikes! This method prints a turnaround time, but as you can see, it&amp;#8217;s a complex
calculation. We&amp;#8217;d be able to understand this much more easily of we used Extract
Method a few times to break it up, but then we risk polluting our Quote class
with more stuff that&amp;#8217;s only relevant to pretty turnaround calculation. Also,
please ignore that this is also presentation on the model; we just care that
it&amp;#8217;s a complex bit of code for this example.&lt;/p&gt;

&lt;p&gt;Okay, so here&amp;#8217;s the first step of this refactoring, which Feathers calls &amp;#8220;Break
Out Method Object.&amp;#8221; You can open your copy of &amp;#8220;Working Effectively With Legacy
Code&amp;#8221; and turn to page 330 to read more. If you don&amp;#8217;t have a copy, get one.
Anyway, I digress. Here&amp;#8217;s the plan of attack:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Create a new class for the computation&lt;/li&gt;
&lt;li&gt;Define a method on that class to do the new work.&lt;/li&gt;
&lt;li&gt;Copy the body of the old method over, and change variable references to instance variables.&lt;/li&gt;
&lt;li&gt;Give it an initialize method that takes arguments to set the instance variables used in step 3.&lt;/li&gt;
&lt;li&gt;Make the old method delegate to the new class and method.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&amp;#8217;ve changed this slightly for Ruby, since we can&amp;#8217;t Lean On The Compiler, and a
few of Feathers&amp;#8217; steps are about doing this. Anyway, let&amp;#8217;s try this on that
code. Step 1:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Quote&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;pretty_turnaround&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;#snip&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TurnaroundCalculator&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Two:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TurnaroundCalculator&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;calculate&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Three:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TurnaroundCalculator&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;calculate&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@turnaround&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;nil?&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@purchased_at&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@purchased_at&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;days_from_today&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;purchased_at&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;floor&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;else&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;days_from_today&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@turnaround&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;offset&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@turnaround&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;elsif&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sun&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%A %d %B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; (&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;days_from_today&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; business days from today)&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;I like to give it a generic name at first, and then give it a better one in step
5, after we see what it really does. often our code will inform us of a good
name.&lt;/p&gt;

&lt;p&gt;Four:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TurnaroundCalculator&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;purchased_at&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;turnaround&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@purchased_at&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;purchased_at&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@turnaround&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;turnaround&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;calculate&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="c1"&gt;#snip&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Five:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Quote&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;pretty_turnaround&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="no"&gt;TurnaroundCalculator&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;purchased_at&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;turnaround&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;calculate&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Done! We should be able to run our tests and see them pass. Even if &amp;#8216;run our
tests&amp;#8217; consists of manually checking it out&amp;#8230;&lt;/p&gt;

&lt;p&gt;So what&amp;#8217;s the advantage here? Well, we now can start the refactoring process,
but we&amp;#8217;re in our own little clean room. We can extract methods into our
TurnaroundCalcuator class without polluting Quote, we can write speedy tests
for just the Calculator, and we&amp;#8217;ve split out the idea of calculation into one
place, where it can easily be changed later. Here&amp;#8217;s our class, a few
refactorings later:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;span class=’line’&gt;12&lt;/span&gt;
&lt;span class=’line’&gt;13&lt;/span&gt;
&lt;span class=’line’&gt;14&lt;/span&gt;
&lt;span class=’line’&gt;15&lt;/span&gt;
&lt;span class=’line’&gt;16&lt;/span&gt;
&lt;span class=’line’&gt;17&lt;/span&gt;
&lt;span class=’line’&gt;18&lt;/span&gt;
&lt;span class=’line’&gt;19&lt;/span&gt;
&lt;span class=’line’&gt;20&lt;/span&gt;
&lt;span class=’line’&gt;21&lt;/span&gt;
&lt;span class=’line’&gt;22&lt;/span&gt;
&lt;span class=’line’&gt;23&lt;/span&gt;
&lt;span class=’line’&gt;24&lt;/span&gt;
&lt;span class=’line’&gt;25&lt;/span&gt;
&lt;span class=’line’&gt;26&lt;/span&gt;
&lt;span class=’line’&gt;27&lt;/span&gt;
&lt;span class=’line’&gt;28&lt;/span&gt;
&lt;span class=’line’&gt;29&lt;/span&gt;
&lt;span class=’line’&gt;30&lt;/span&gt;
&lt;span class=’line’&gt;31&lt;/span&gt;
&lt;span class=’line’&gt;32&lt;/span&gt;
&lt;span class=’line’&gt;33&lt;/span&gt;
&lt;span class=’line’&gt;34&lt;/span&gt;
&lt;span class=’line’&gt;35&lt;/span&gt;
&lt;span class=’line’&gt;36&lt;/span&gt;
&lt;span class=’line’&gt;37&lt;/span&gt;
&lt;span class=’line’&gt;38&lt;/span&gt;
&lt;span class=’line’&gt;39&lt;/span&gt;
&lt;span class=’line’&gt;40&lt;/span&gt;
&lt;span class=’line’&gt;41&lt;/span&gt;
&lt;span class=’line’&gt;42&lt;/span&gt;
&lt;span class=’line’&gt;43&lt;/span&gt;
&lt;span class=’line’&gt;44&lt;/span&gt;
&lt;span class=’line’&gt;45&lt;/span&gt;
&lt;span class=’line’&gt;46&lt;/span&gt;
&lt;span class=’line’&gt;47&lt;/span&gt;
&lt;span class=’line’&gt;48&lt;/span&gt;
&lt;span class=’line’&gt;49&lt;/span&gt;
&lt;span class=’line’&gt;50&lt;/span&gt;
&lt;span class=’line’&gt;51&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TurnaroundCalculator&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;calculate&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@turnaround&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;nil?&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;arrival_date&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; (&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;days_from_today&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; business days from today)&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="kp"&gt;protected&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;arrival_date&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;real_turnaround_time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%A %d %B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;real_turnaround_time&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;adjust_time_for_weekends&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;start_time&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;turnaround_in_seconds&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;adjust_time_for_weekends&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;saturday?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;elsif&lt;/span&gt; &lt;span class="n"&gt;sunday?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;else&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;time&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;saturday?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sat&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;sunday?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Sun&amp;quot;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;turnaround_in_seconds&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@turnaround&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;start_time&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="vi"&gt;@purchased_at&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;days_from_today&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vi"&gt;@purchased_at&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="vi"&gt;@purchased_at&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;floor&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;else&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="vi"&gt;@turnaround&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Wow. This code I wrote three years ago isn&amp;#8217;t perfect, but it&amp;#8217;s almost
understandable now. And each of the bits makes sense. This is after two or three
waves of refactoring, which maybe I&amp;#8217;ll cover in a separate post, becuase this
was more illustrative than I thought&amp;#8230; anyway, you get the idea. This is what I
mean when I say that I shoot for roughly five-line methods in Ruby; if your code
is well-factored, you can often get there.&lt;/p&gt;

&lt;p&gt;This idea of extracting domain objects that are pure Ruby is even in Rails
itself. Check out this route:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="n"&gt;root&lt;/span&gt; &lt;span class="ss"&gt;:to&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;dashboard#index&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:constraints&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="no"&gt;LoggedInConstraint&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Huh? LoggedInConstraint?&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;LoggedInConstraint&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;matches?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="n"&gt;current_user&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;Whoah. Yep. A domain object that describes our routing policy. Awesome. Also,
validations, blatantly stolen from &lt;a href="http://omgbloglol.com/post/392895742/improved-validations-in-rails-3"&gt;omgbloglol&lt;/a&gt;:&lt;/p&gt;

&lt;figure role=code&gt; &lt;div class="highlight"&gt;&lt;table cellpadding="0" cellspacing="0"&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre class="line-numbers"&gt;&lt;span class=’line’&gt;1&lt;/span&gt;
&lt;span class=’line’&gt;2&lt;/span&gt;
&lt;span class=’line’&gt;3&lt;/span&gt;
&lt;span class=’line’&gt;4&lt;/span&gt;
&lt;span class=’line’&gt;5&lt;/span&gt;
&lt;span class=’line’&gt;6&lt;/span&gt;
&lt;span class=’line’&gt;7&lt;/span&gt;
&lt;span class=’line’&gt;8&lt;/span&gt;
&lt;span class=’line’&gt;9&lt;/span&gt;
&lt;span class=’line’&gt;10&lt;/span&gt;
&lt;span class=’line’&gt;11&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=’code’ width=’100%’&gt;&lt;pre&gt;&lt;code class=’ruby’&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;SomeClass&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="n"&gt;validate&lt;/span&gt; &lt;span class="ss"&gt;:category_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:proper_category&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ProperCategoryValidator&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveModel&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;EachValidator&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;validate_each&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;attribute&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;unless&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;category_ids&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;include?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;      &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;errors&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt; &lt;span class="n"&gt;attribute&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;has bad category.&amp;#39;&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;div class=’line’&gt;&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;


&lt;p&gt;This isn&amp;#8217;t a plain Ruby class, but you get the idea.&lt;/p&gt;

&lt;p&gt;Now, you might be thinking, &amp;#8220;Steve: This isn&amp;#8217;t just for Rails! You&amp;#8217;ve lied!&amp;#8221; Why
yes, actually, you&amp;#8217;ve caught me: this isn&amp;#8217;t the secret to Rails OO, it&amp;#8217;s more of
a general OO design guideline. But there&amp;#8217;s something special about Rails which
seems to lure you into the trap of never breaking classes down. Maybe it&amp;#8217;s that
&lt;code&gt;lib/&lt;/code&gt; feels like such a junk drawer. Maybe it&amp;#8217;s that the fifteen minute
examples only ever include ActiveRecord models. Maybe it&amp;#8217;s that more Rails apps
than not are (WARNING: UNSUBSTANTIATED CLAIM ALERT) closed source than open, so
we don&amp;#8217;t have as many good examples to draw upon. (I have this hunch since
Rails is often used to build sites for companies. Gems? Sure? My web app? Not so
much. I have no stats to back this up, though.)&lt;/p&gt;

&lt;p&gt;In summary: Extracting domain objects is good. They keep your tests fast, your
code small, and make it easier to change things later. I have some more to say
about this, specifically the &amp;#8220;keeps test fast&amp;#8221; part, but I&amp;#8217;m already pushing it
for length here. Until next time!&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=eHyKEdSN4tw:PhXBqeUBv_Q:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=eHyKEdSN4tw:PhXBqeUBv_Q:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=eHyKEdSN4tw:PhXBqeUBv_Q:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=eHyKEdSN4tw:PhXBqeUBv_Q:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=eHyKEdSN4tw:PhXBqeUBv_Q:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/eHyKEdSN4tw" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/09/06/the-secret-to-rails-oo-design.html</feedburner:origLink></entry>
  
  <entry>
    <title>The Self-Improvement Pomodoro</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/YhkU1917aeA/the-self-improvement-pomodoro.html" />
    <updated>2011-09-04T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/09/04/the-self-improvement-pomodoro</id>
    <content type="html">&lt;p&gt;By now, the &lt;a href="http://www.pomodorotechnique.com/"&gt;pomodoro technique&lt;/a&gt; is pretty
well-known amongst programmers. I forget where I heard of it first, but
if you haven&amp;#8217;t, here it is: Break your day up into 30 minute chunks.
Work for 25 minutes, break for 5. Repeat. It&amp;#8217;s easy to stay concentrated
when you know a break is coming up soon, the fact that you can fit two
in an hour fits with my natural sense of order in the world, and once
you get in the rhythm, you Get Shit Done. Heck, I liked the idea so much
that I &lt;a href="http://rubygems.org/gems/pomodoro"&gt;made a Ruby gem&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;That said, I hadn&amp;#8217;t been following the technique for a while, because
it&amp;#8217;s easy to lose discipline. Happens to the best of us. Recently,
though, it&amp;#8217;s crept back into my workflow, largely thanks to Jeff
Casimir. I was even lazy enough to not use my gem, and try something
else. So I grabbed the software he uses from the App Store, and fired it
up. It presented me with an interesting option to give my pomodoro a
name before starting it. Pretty much without thinking, I typed &amp;#8216;rstat.us
rails3 port,&amp;#8217; since that&amp;#8217;s what I was working on, and away I went.&lt;/p&gt;

&lt;p&gt;The more I think about it, however, the more interesting the naming
aspect becomes. I can see how long and how often I&amp;#8217;m working on various
things, and over the past few weeks, it&amp;#8217;s been neat to examine. When
doing some reading this morning, my groggy brain combined a few
different things together:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Programmers often don&amp;#8217;t have the time to practice their craft&lt;/li&gt;
&lt;li&gt;I work on a lot of random software projects&lt;/li&gt;
&lt;li&gt;These projects are often of varying quality, especially regarding
things like documentation and tests&lt;/li&gt;
&lt;li&gt;Almost none of the gems that have been released are at a 1.0 release
(can anyone find this blog post for me? I can&amp;#8217;t. It&amp;#8217;s something about
&amp;#8220;Just Release It&amp;#8221;&amp;#8230;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, with an aim of combining all these things, I&amp;#8217;m going to give
something a try, and you should too: I&amp;#8217;m going to name at least one
pomodoro a day &amp;#8220;self-improvement,&amp;#8221; and use that time to go back over my
random projects on GitHub and clean them up. I&amp;#8217;m going to use that time
to start programming in a totally new language. I&amp;#8217;m going to use that
time to do that refactoring I&amp;#8217;ve been avoiding. I&amp;#8217;m going to use that
time to read a book.&lt;/p&gt;

&lt;p&gt;Basically, I&amp;#8217;m going to force myself to invest in myself. Make sure to
find time to invest in you, too.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=YhkU1917aeA:BAtSs9Wn4Uo:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=YhkU1917aeA:BAtSs9Wn4Uo:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=YhkU1917aeA:BAtSs9Wn4Uo:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=YhkU1917aeA:BAtSs9Wn4Uo:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=YhkU1917aeA:BAtSs9Wn4Uo:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/YhkU1917aeA" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/09/04/the-self-improvement-pomodoro.html</feedburner:origLink></entry>
  
  <entry>
    <title>I’m Making It Dead Simple To Contribute To Ruby’s Documentation</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/3ksF2kev_M4/im-making-it-dead-simple-to-contribute-to-ruby-s-documentation.html" />
    <updated>2011-08-22T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/08/22/im-making-it-dead-simple-to-contribute-to-ruby-s-documentation</id>
    <content type="html">&lt;p&gt;Okay! So, if you&amp;#8217;d read &lt;a href="http://blog.steveklabnik.com/2011/05/10/contributing-to-ruby-s-documentation.html"&gt;my previous article on
this&lt;/a&gt;, you&amp;#8217;d know how
easy it is to contribute to Ruby&amp;#8217;s Documentaiton.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But Steve, I&amp;#8217;m &lt;em&gt;still&lt;/em&gt; kinda scared.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Okay, so here we go: I&amp;#8217;m making it even easier on you.&lt;/p&gt;

&lt;p&gt;Send me what you want changed, and how, and I&amp;#8217;ll make a patch and submit
it on your behalf.&lt;/p&gt;

&lt;p&gt;No, seriously, I will. I already did once. &lt;a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/38873"&gt;This guy&lt;/a&gt; posted something about how it was too hard, &lt;a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/38875"&gt;so
I made a patch for him&lt;/a&gt;. And now Ruby is better because of it.&lt;/p&gt;

&lt;h2&gt;Patches don&amp;#8217;t have to be patches&lt;/h2&gt;

&lt;p&gt;Seriously, I don&amp;#8217;t even mean diff outputs. I just got this email:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&amp;#8217;m eager to contribute docs but I don&amp;#8217;t know where to start: I don&amp;#8217;t
mean pulling down the repo and all that, I mean, I see this link
here:http://segment7.net/projects/ruby/documentation_coverage.txt but
all I see is a ton of &amp;#8220;# is documented&amp;#8221; comments. Where does a
relative n00b begin? Poking around in the source code is, well,
intimidating. I&amp;#8217;m completely new to this but I take direction well.
Just point me in the right direction. Just give me something to
document, please!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I sent this back:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;No code diving needed! That&amp;#8217;s part of it. Let&amp;#8217;s do this: Find the documentation for one of your favorite methods. Here, I&amp;#8217;ll pick one: http://ruby-doc.org/core/classes/Array.html#M000278 okay, that looks okay, but look at compact!:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Removes nil elements from the array. Returns nil if no changes were made, otherwise returns &lt;/i&gt;ary&lt;/i&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why&amp;#8217;s that &lt;/i&gt; there? Total screw-up.  For example. So, send me this email:&lt;/p&gt;

&lt;p&gt;&amp;#8220;Hey Steve-&lt;/p&gt;

&lt;p&gt;Check out the docs for Array#compact!, here: http://ruby-doc.org/core/classes/Array.html#M000279 . There&amp;#8217;s an extra &lt;/i&gt; that&amp;#8217;s screwing things up.&lt;/p&gt;

&lt;p&gt;-Jonathan&amp;#8221;&lt;/p&gt;

&lt;p&gt;Done! I&amp;#8217;ll go from there. How about this one:&lt;/p&gt;

&lt;p&gt;&amp;#8220;Hey Steve-&lt;/p&gt;

&lt;p&gt;I checked out the docs for Time._load, here: http://www.ruby-doc.org/core/classes/Time.html#M000394&lt;/p&gt;

&lt;p&gt;These docs kind of suck. What if I don&amp;#8217;t know what Marshal is? There should at &lt;em&gt;least&lt;/em&gt; be a link to Marshall, here: http://ruby-doc.org/core/classes/Marshal.html And it should probably say something like &amp;#8220;You can get a dumped Time object by using _dump: http://www.ruby-doc.org/core/classes/Time.html#M000393&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Jonathan&amp;#8221;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&amp;#8217;m sure you can find something that&amp;#8217;s formatted wrong, or worded incorrectly, or anything else.&lt;/p&gt;

&lt;p&gt;-Steve&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Now, the &lt;em&gt;closer&lt;/em&gt; it is to an actual patch, the faster I&amp;#8217;ll be able to
do it. A vague &amp;#8220;this documentation is confusing, but I&amp;#8217;m not sure why&amp;#8221;
is helpful, but will take longer. I&amp;#8217;d rather get that email than not. If
you&amp;#8217;re not sure, hit send.&lt;/p&gt;

&lt;h2&gt;Just Do It&lt;/h2&gt;

&lt;p&gt;And so I&amp;#8217;ll do it again. Scared to deal with doc patches? I&amp;#8217;ll make them
up. I&amp;#8217;m serious. I&amp;#8217;ll do it. Send them to me.&lt;/p&gt;

&lt;p&gt;That&amp;#8217;s all.&lt;/p&gt;

&lt;p&gt;Send me patches.
&lt;a href="mailto:steve@steveklabnik.com"&gt;steve@steveklabnik.com&lt;/a&gt;. Do it.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=3ksF2kev_M4:S6DZPsOZ4Kg:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=3ksF2kev_M4:S6DZPsOZ4Kg:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=3ksF2kev_M4:S6DZPsOZ4Kg:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=3ksF2kev_M4:S6DZPsOZ4Kg:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=3ksF2kev_M4:S6DZPsOZ4Kg:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/3ksF2kev_M4" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/08/22/im-making-it-dead-simple-to-contribute-to-ruby-s-documentation.html</feedburner:origLink></entry>
  
  <entry>
    <title>Matz is Nice So We Are Nice</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/SPo4XkthJjA/matz-is-nice-so-we-are-nice.html" />
    <updated>2011-08-19T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/08/19/matz-is-nice-so-we-are-nice</id>
    <content type="html">&lt;p&gt;Rubyists have a saying, or at least, we used to. &amp;#8220;Matz is nice so we are
nice.&amp;#8221; This has sort of been lost over the years&amp;#8230; some people who have
been around Ruby for a long time still say this, but it&amp;#8217;s something
that&amp;#8217;s gone in and out of popularity.&lt;/p&gt;

&lt;h2&gt;Nice should be the default&lt;/h2&gt;

&lt;p&gt;Most of being nice, in a software context, is about being considerate.
Not unnecessarily trash talking other people&amp;#8217;s stuff. Not going out of
your way to be a jerk. Try to be helpful. Treat others how you want to
be treated.&lt;/p&gt;

&lt;h2&gt;Sometimes, the truth hurts&lt;/h2&gt;

&lt;p&gt;Being considerate of others, however, can only go so far. While a lot of
what we do is subjective, a lot of is objective, too. If you&amp;#8217;re building
a new project, not saying &amp;#8220;this is why we&amp;#8217;re awesome&amp;#8221; is silly. Old code
is often bad. Other people&amp;#8217;s code is often bad. The key in &amp;#8220;not
unnecessarily trash talking&amp;#8217; is the &lt;em&gt;neccesary&lt;/em&gt; part. There&amp;#8217;s a
difference between &amp;#8220;My library is better&amp;#8221; and &amp;#8220;My library is better and
their library sucks.&amp;#8221;&lt;/p&gt;

&lt;h2&gt;The last thing I&amp;#8217;ll say about RVM Drama&lt;/h2&gt;

&lt;p&gt;After talking to a few people, I guess I committed a bit of the sin I
was trying to rail against: I got some feedback that it was thought that
I was villainizing Sam, and a little easy on Wayne. This is natural,
because I&amp;#8217;m friends with Wayne and I don&amp;#8217;t really know Sam, but in the
interest of being nice myself, I just want to say this: I think that all
that drama last week was largely a perfect storm of a few different
factors, and I don&amp;#8217;t think that Sam set out to hurt anyone specifically.
If and when I ever have an issue with RVM, I&amp;#8217;m totally going to try out
rbenv. I like having options. I like there being multiple options.
TMTOWTDI. And Sam builds a ton of other software that I really enjoy,
like Sprockets, and pow. There&amp;#8217;s a big difference between &amp;#8220;that guy is
an asshole&amp;#8221; and &amp;#8220;I think that that situation could have been handled
better.&amp;#8221;&lt;/p&gt;

&lt;p&gt;Let&amp;#8217;s all build lots of cool software together.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=SPo4XkthJjA:wKCQ9Dcdb_o:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=SPo4XkthJjA:wKCQ9Dcdb_o:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=SPo4XkthJjA:wKCQ9Dcdb_o:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=SPo4XkthJjA:wKCQ9Dcdb_o:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=SPo4XkthJjA:wKCQ9Dcdb_o:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/SPo4XkthJjA" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/08/19/matz-is-nice-so-we-are-nice.html</feedburner:origLink></entry>
  
  <entry>
    <title>We Forget That Open Source is Made of People</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/yU28fuJdgqk/we-forget-that-open-source-is-made-of-people.html" />
    <updated>2011-08-12T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/08/12/we-forget-that-open-source-is-made-of-people</id>
    <content type="html">&lt;p&gt;Programmers like to think that software is the purest form of
meritocracy. We like to consider ourselves scientists; what we do is
entirely impersonal. I&amp;#8217;m at Lone Star Ruby right now, and the first two
talks are entirely about software as a science.&lt;/p&gt;

&lt;p&gt;But this is a fallacy. There&amp;#8217;s a human element to open source that&amp;#8217;s
often totally forgotten, and it drives people away.&lt;/p&gt;

&lt;h2&gt;Software Celebrity and Hero Worship&lt;/h2&gt;

&lt;p&gt;We sort of acknowledge this, in a way. There are most certainly software
celebrities, even if their celebrity is localized to the community in
which they operate. I heard someone say this today:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If I can go to one Ruby conference and not hear anyone mention Zed
Shaw or _why, I can die happy.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If I say &amp;#8220;jnicklas&amp;#8221; you say &amp;#8220;Capybara.&amp;#8221; If I say &amp;#8220;DHH&amp;#8221; you say &amp;#8220;Rails.&amp;#8221;
If I say &amp;#8220;matz&amp;#8221; you say &amp;#8220;Ruby.&amp;#8221; We have our heroes, villains, and foils,
just like anybody else. But we forget that in every celebrity, there is
a real person in there. Actual people, who have real thoughts, feelings,
ideas, emotions, and that spend all of their time working for free just
to make your lives better out of the goodness of their heart. Often
&lt;em&gt;after&lt;/em&gt; working at day jobs, often &lt;em&gt;at the expense&lt;/em&gt; of a personal life,
often &lt;em&gt;straining relationships&lt;/em&gt; with people they care about.&lt;/p&gt;

&lt;h2&gt;Competition Means Somebody Loses&lt;/h2&gt;

&lt;p&gt;I used to think that Git was great because it made forks trivial. It
changed what we mean by &amp;#8216;fork.&amp;#8217; This is largely a good thing. But &amp;#8216;the
eff word&amp;#8217; used to be a last resort. The nuclear option. You&amp;#8217;re fed up,
can&amp;#8217;t take it anymore, and so this is what they&amp;#8217;ve driven you to do.
Forking was Serious Business.&lt;/p&gt;

&lt;p&gt;Now, GitHub has made it so easy to fork a project and distribute it to
tons of people, people just fork things willy-nilly. And, from the
outside, competition is good: in theory, it means that the good ideas
work and the bad ideas don&amp;#8217;t.&lt;/p&gt;

&lt;p&gt;(A small aside: forking in git is different than &amp;#8216;forking&amp;#8217; in svn. This
overloading of terminology is unfortunate. The fork button is actually
one of my favorite features of GitHub, because it makes contribution
easier. But as it&amp;#8217;s easier to publish new software, it&amp;#8217;s easier to
&amp;#8216;fork&amp;#8217; in the svn sense. It used to be a pain to start a new project,
and GitHub&amp;#8217;s made that so easy that it happens more often than I think
it should.)&lt;/p&gt;

&lt;p&gt;But guess what: competition sucks. Cooperation is much better. One of
the biggest problems with competition is that it means that somebody has
to lose. For every winner, someone is a loser. That person is going to
be hurting. In the case of open source, someone has spent (possibly)
years of their life working on something, and now, all of that is gone.
That shit stings.&lt;/p&gt;

&lt;p&gt;Sometimes, forks are necessary. Sometimes, there are approaches that are
fundamentally different. Forking is still an option, even if it&amp;#8217;s a last
resort. I&amp;#8217;m also not saying that feelings should totally trump technical
merit. All I&amp;#8217;m saying is this: consider the blood, sweat, and tears of
others before you act. Just in general.&lt;/p&gt;

&lt;p&gt;It&amp;#8217;s also not a zero-sum game, either. The pie can be grown. But that
also doesn&amp;#8217;t mean that it&amp;#8217;s grown in a way that makes anyone feel good
about it. There&amp;#8217;s a difference between &amp;#8220;We represent two sides of some
coin&amp;#8221; and &amp;#8220;Those fuckers make shitty software.&amp;#8221; Both approaches can grow
the pie. One is far better than the other.&lt;/p&gt;

&lt;p&gt;What&amp;#8217;s the human cost of rapid competition between software projects? Is
this cost worth it?&lt;/p&gt;

&lt;h2&gt;Open Source: All take, no give&lt;/h2&gt;

&lt;p&gt;The Pareto Principle: 80% of the effects come from 20% of the causes.
This is absolutely true in OSS, and it might be more imbalanced. A few
people contribute, and lots of people use. Sometimes, this is a good
thing: it&amp;#8217;s actually what draws me to open source. I can help people in
a scalable way. My code is currently being used by tens of thousands of
people. This is awesome. Some documentation that I&amp;#8217;ve written is being
read by millions of people. This is way more awesome.&lt;/p&gt;

&lt;p&gt;But I rarely get any help with my projects. It&amp;#8217;s really easy to let that
get to a person.&lt;/p&gt;

&lt;p&gt;Do you know how many people have told me that what I do is important? I
got given a Ruby Hero award for my work on Hackety and Shoes. Do you
know how many commits I have in on them? Probably less than 200. Do you
know why? I&amp;#8217;ve spent weeks of my life trying to track down bugs, but some
of them are too hard for me, at my current stage of programming-fu. And
it gets depressing. And everyone that&amp;#8217;s ever offered to help has flaked
on me. And all the recognition for something that was largely done by
someone else gets to me, really deeply. And I get tons of people
screaming about Lion support, and &amp;#8216;this doesn&amp;#8217;t work,&amp;#8217; and all sorts of
things&amp;#8230; and no patches. It&amp;#8217;s why the &amp;#8216;patches accepted&amp;#8217; saying was
coined: this shit grinds on you after a while.&lt;/p&gt;

&lt;h2&gt;All of my Heroes are Dying&lt;/h2&gt;

&lt;p&gt;Today, this situation with rbenv and rvm made me realize something:
everyone that I truly, deeply respect in open source has either burned
out or left. I&amp;#8217;ve said once before that there are four people that I
truly respect in software: Zed Shaw, _why, Yehuda Katz, and (more
recently) Wayne Seguin (and also Aaron Patterson. Dammit. This list is
getting long). All of these developers are brilliant, work hard, and are
tirelessly supporting their communities. That is, until they were driven
away. This isn&amp;#8217;t totally applicable to Yehuda, but it happened to Zed.
It happened to _why. And I can see it happening, right now, to Aaron
and Wayne. And Yehuda isn&amp;#8217;t really doing Ruby&amp;#8230;&lt;/p&gt;

&lt;p&gt;But seeing this happen makes me deeply sad. For them personally, for my
own selfish reasons, and that that&amp;#8217;s the state of our communities.&lt;/p&gt;

&lt;h2&gt;Where Does This Leave Us?&lt;/h2&gt;

&lt;p&gt;I don&amp;#8217;t have any answers. I only have a bunch of questions:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Why do we drive people away from Open Source?&lt;/li&gt;
&lt;li&gt;Can we learn to work together, instead of competing?&lt;/li&gt;
&lt;li&gt;How can we better recognize this human element?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If you don&amp;#8217;t contribute to Open Source: please consider thanking someone
that does open source, in a project that you love. Consider helping out,
in even the smallest of ways.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;&lt;a href="http://blog.steveklabnik.com/2011/08/19/matz-is-nice-so-we-are-nice.html"&gt;My next post is a bit of a follow-up to this&lt;/a&gt;.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=yU28fuJdgqk:KcZLIfSnN-g:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=yU28fuJdgqk:KcZLIfSnN-g:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=yU28fuJdgqk:KcZLIfSnN-g:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=yU28fuJdgqk:KcZLIfSnN-g:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=yU28fuJdgqk:KcZLIfSnN-g:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/yU28fuJdgqk" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/08/12/we-forget-that-open-source-is-made-of-people.html</feedburner:origLink></entry>
  
  <entry>
    <title>Some People Understand REST and HTTP</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/drzCj0YBRcs/some-people-understand-rest-and-http.html" />
    <updated>2011-08-07T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/08/07/some-people-understand-rest-and-http</id>
    <content type="html">&lt;p&gt;This is a follow-up post to my post &lt;a href="http://blog.steveklabnik.com/2011/07/03/nobody-understands-rest-or-http.html"&gt;here&lt;/a&gt;. You probably want to
read that first.&lt;/p&gt;

&lt;h2&gt;A few words on standards versus pragmatism&lt;/h2&gt;

&lt;p&gt;When I wrote my first post on this topic, I tried to take a stance that
would be somewhat soft, yet forceful. Engineering is the art of making
the proper trade-offs, and there are times when following specifications
is simply not the correct decision. With that said, my motivation for
both of these posts is to eradicate some of the ignorance that some
developers have about certain areas of the HTTP spec and Fielding&amp;#8217;s REST
paper. If you understand the correct way, yet choose to do something
else for an informed reason, that&amp;#8217;s absolutely, 100% okay. There&amp;#8217;s no
use throwing out the baby with the bathwater. But ignorance is never a
good thing, and most developers are ignorant when it comes to the
details of REST.&lt;/p&gt;

&lt;p&gt;Secondly, while I think that REST is the best way to develop APIs, there
are other valid architectural patterns, too. Yet calling non-REST APIs
&amp;#8216;RESTful&amp;#8217; continues to confuse developers as to what &amp;#8220;RESTful&amp;#8221; means.
I&amp;#8217;m not sure what exactly we should call &amp;#8220;RESTish&amp;#8221; APIs (hey, there we
go, hmmm&amp;#8230;) but I&amp;#8217;m also not under the illusion that I personally will
be able to make a huge dent in this. Hopefully you, humble reader, will
remember this when dealing with APIs in the future, and I&amp;#8217;ll have made a
tiny dent, though.&lt;/p&gt;

&lt;h2&gt;So who &lt;em&gt;does&lt;/em&gt; understand REST?&lt;/h2&gt;

&lt;p&gt;As it turns out, there are two companies that you&amp;#8217;ve probably heard of
who have APIs that are much more RESTful than many others: &lt;a href="http://www.twilio.com/docs/api/rest/"&gt;Twilio&lt;/a&gt;
and &lt;a href="http://developer.github.com/"&gt;GitHub&lt;/a&gt;. Let&amp;#8217;s take a look at GitHub first.&lt;/p&gt;

&lt;h3&gt;GitHub: logically awesome&lt;/h3&gt;

&lt;p&gt;GitHub&amp;#8217;s developer resources are not only beautiful, but thorough. In
addition, they make use of lots more of REST.&lt;/p&gt;

&lt;h4&gt;The good&lt;/h4&gt;

&lt;p&gt;GitHub uses &lt;a href="http://developer.github.com/v3/mimes/"&gt;custom MIME&lt;/a&gt; types for all of their responses. They&amp;#8217;re
using the vendor extensions that I talked about in my post, too. For
example:&lt;/p&gt;

&lt;p&gt;  application/vnd.github-issue.text+json&lt;/p&gt;

&lt;p&gt;Super cool.&lt;/p&gt;

&lt;p&gt;Their &lt;a href="http://developer.github.com/v3/#authentication"&gt;authentication&lt;/a&gt; works in three ways: HTTP Basic, OAuth via an
Authentication Header, or via a parameter. This allows for a maximum
amount of compatibility across user agents, and gives the user some
amount of choice.&lt;/p&gt;

&lt;p&gt;Their &lt;a href="http://developer.github.com/v3/#pagination"&gt;Pagination&lt;/a&gt; uses a header I didn&amp;#8217;t discuss in part I: the Link
header. &lt;a href="http://tools.ietf.org/html/rfc5988"&gt;Here&lt;/a&gt;&amp;#8217;s a link to the
reference. Basically, Link headers enable HATEOAS for media types which
aren&amp;#8217;t hypertext. This is important, especially regarding JSON, since
JSON isn&amp;#8217;t hypermedia. More on this at the end of the post. Anyway, so
pagination on GitHub:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl -I "https://api.github.com/users/steveklabnik/gists"
HTTP/1.1 200 OK
Server: nginx/1.0.4
Date: Sun, 07 Aug 2011 16:34:48 GMT
Content-Type: application/json
Connection: keep-alive
Status: 200 OK
X-RateLimit-Limit: 5000
X-RateLimit-Remaining: 4994
Link: &amp;lt;https://api.github.com/users/steveklabnik/gists?page=2&amp;gt;; rel="next", &amp;lt;https://api.github.com/users/steveklabnik/gists?page=33333&amp;gt;; rel="last"
Content-Length: 29841
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The Link header there shows you how to get to the next page of results.
You don&amp;#8217;t need to know how to construct the URL, you just have to parse
the header and follow it. This, for example, is a great way to connect a
resource that&amp;#8217;s not text-based, such as a PNG, to other resources.&lt;/p&gt;

&lt;h4&gt;The bad&lt;/h4&gt;

&lt;p&gt;There&amp;#8217;s really only one place that GitHub doesn&amp;#8217;t knock it out of the
park with their new API, and that&amp;#8217;s HATEOAS. GitHub&amp;#8217;s API isn&amp;#8217;t
discoverable, because there&amp;#8217;s no information at the root:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl -I https://api.github.com/
HTTP/1.1 302 Found
Server: nginx/1.0.4
Date: Sun, 07 Aug 2011 16:44:02 GMT
Content-Type: text/html;charset=utf-8
Connection: keep-alive
Status: 302 Found
X-RateLimit-Limit: 5000
Location: http://developer.github.com
X-RateLimit-Remaining: 4993
Content-Length: 0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Well, at least, this is how they present it. If you ask for JSON:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl -I https://api.github.com/ -H "Accept: application/json"
HTTP/1.1 204 No Content
Server: nginx/1.0.4
Date: Sun, 07 Aug 2011 16:45:32 GMT
Connection: keep-alive
Status: 204 No Content
X-RateLimit-Limit: 5000
X-RateLimit-Remaining: 4991
Link: &amp;lt;users/{user}&amp;gt;; rel="user", &amp;lt;repos/{user}/{repo}&amp;gt;; rel="repo", &amp;lt;gists&amp;gt;; rel="gists"
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You do get Links, but you have to construct things yourself. As a user,
you get the same thing. It doesn&amp;#8217;t change the links to point to your
repos, it doesn&amp;#8217;t give you links to anything else that you can do with
the API.&lt;/p&gt;

&lt;p&gt;Instead, the root should give you a link to the particular resources
that you can actually view. Maybe something like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl -I https://api.github.com/ -H "Accept: application/json" -u
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&amp;#8220;username:password&amp;#8221;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;HTTP/1.1 204 No Content
Server: nginx/1.0.4
Date: Sun, 07 Aug 2011 16:45:32 GMT
Connection: keep-alive
Status: 204 No Content
X-RateLimit-Limit: 5000
X-RateLimit-Remaining: 4991
Link: &amp;lt;/gists/public&amp;gt;; rel="public_gists", &amp;lt;/user/repos&amp;gt;; rel="repos", &amp;lt;gists&amp;gt;; rel="gists"
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And a bunch more, for all of the other resources that are available.
This would make the API truly discoverable, and you wouldn&amp;#8217;t be forced
to read their gorgeous documentation. :)&lt;/p&gt;

&lt;h3&gt;Twilio&lt;/h3&gt;

&lt;p&gt;I&amp;#8217;ve always really enjoyed Twilio. Their API is incredibly simple to
use. I once hooked up a little &amp;#8220;Text me when someone orders something
from my site&amp;#8221; script, and it took me about fifteen minutes. Good stuff.&lt;/p&gt;

&lt;h4&gt;The good&lt;/h4&gt;

&lt;p&gt;Twilio has got the HATEOAS thing down. Check it out, their home page
says that the base URL is &amp;#8220;https://api.twilio.com/2010-04-01&amp;#8221;. Without
looking at any of the rest of their docs, (I glanced at a page or two,
but I didn&amp;#8217;t really read them fully yet), I did this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl https://api.twilio.com/2010-04-01
&amp;lt;?xml version="1.0"?&amp;gt;
&amp;lt;TwilioResponse&amp;gt;
  &amp;lt;Version&amp;gt;
    &amp;lt;Name&amp;gt;2010-04-01&amp;lt;/Name&amp;gt;
    &amp;lt;Uri&amp;gt;/2010-04-01&amp;lt;/Uri&amp;gt;
    &amp;lt;SubresourceUris&amp;gt;
      &amp;lt;Accounts&amp;gt;/2010-04-01/Accounts&amp;lt;/Accounts&amp;gt;
    &amp;lt;/SubresourceUris&amp;gt;
  &amp;lt;/Version&amp;gt;
&amp;lt;/TwilioResponse&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I introduced some formatting. Hmm, okay, Accounts. Let&amp;#8217;s check this out:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl https://api.twilio.com/2010-04-01/Accounts&amp;lt;?xml version="1.0"?&amp;gt;
&amp;lt;TwilioResponse&amp;gt;&amp;lt;RestException&amp;gt;&amp;lt;Status&amp;gt;401&amp;lt;/Status&amp;gt;&amp;lt;Message&amp;gt;Authenticate&amp;lt;/Message&amp;gt;&amp;lt;Code&amp;gt;20003&amp;lt;/Code&amp;gt;&amp;lt;MoreInfo&amp;gt;http://www.twilio.com/docs/errors/20003&amp;lt;/MoreInfo&amp;gt;&amp;lt;/RestException&amp;gt;&amp;lt;/TwilioResponse&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Okay, so I have to be authenticated. If I was, I&amp;#8217;d get something like
this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;TwilioResponse&amp;gt;
  &amp;lt;Account&amp;gt;
    &amp;lt;Sid&amp;gt;ACba8bc05eacf94afdae398e642c9cc32d&amp;lt;/Sid&amp;gt;
    &amp;lt;FriendlyName&amp;gt;Do you like my friendly name?&amp;lt;/FriendlyName&amp;gt;
    &amp;lt;Type&amp;gt;Full&amp;lt;/Type&amp;gt;
    &amp;lt;Status&amp;gt;active&amp;lt;/Status&amp;gt;
    &amp;lt;DateCreated&amp;gt;Wed, 04 Aug 2010 21:37:41 +0000&amp;lt;/DateCreated&amp;gt;
    &amp;lt;DateUpdated&amp;gt;Fri, 06 Aug 2010 01:15:02 +0000&amp;lt;/DateUpdated&amp;gt;
    &amp;lt;AuthToken&amp;gt;redacted&amp;lt;/AuthToken&amp;gt;
    &amp;lt;Uri&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d&amp;lt;/Uri&amp;gt;
    &amp;lt;SubresourceUris&amp;gt;
      &amp;lt;AvailablePhoneNumbers&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/AvailablePhoneNumbers&amp;lt;/AvailablePhoneNumbers&amp;gt;
      &amp;lt;Calls&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/Calls&amp;lt;/Calls&amp;gt;
      &amp;lt;Conferences&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/Conferences&amp;lt;/Conferences&amp;gt;
      &amp;lt;IncomingPhoneNumbers&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/IncomingPhoneNumbers&amp;lt;/IncomingPhoneNumbers&amp;gt;
      &amp;lt;Notifications&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/Notifications&amp;lt;/Notifications&amp;gt;
      &amp;lt;OutgoingCallerIds&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/OutgoingCallerIds&amp;lt;/OutgoingCallerIds&amp;gt;
      &amp;lt;Recordings&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/Recordings&amp;lt;/Recordings&amp;gt;
      &amp;lt;Sandbox&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/Sandbox&amp;lt;/Sandbox&amp;gt;
      &amp;lt;SMSMessages&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/SMS/Messages&amp;lt;/SMSMessages&amp;gt;
      &amp;lt;Transcriptions&amp;gt;/2010-04-01/Accounts/ACba8bc05eacf94afdae398e642c9cc32d/Transcriptions&amp;lt;/Transcriptions&amp;gt;
    &amp;lt;/SubresourceUris&amp;gt;
  &amp;lt;/Account&amp;gt;
&amp;lt;/TwilioResponse&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Awesome. I can see my all of the other resources that I can interact
with. Other than knowing how to authenticate, I can follow the links
from the endpoint, and discover their entire API. Rock. This is the way
things are supposed to be.&lt;/p&gt;

&lt;h4&gt;The bad&lt;/h4&gt;

&lt;p&gt;This:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl https://api.twilio.com/2010-04-01/Accounts -H "Accept: application/json"
&amp;lt;?xml version="1.0"?&amp;gt;
&amp;lt;TwilioResponse&amp;gt;&amp;lt;RestException&amp;gt;&amp;lt;Status&amp;gt;401&amp;lt;/Status&amp;gt;&amp;lt;Message&amp;gt;Authenticate&amp;lt;/Message&amp;gt;&amp;lt;Code&amp;gt;20003&amp;lt;/Code&amp;gt;&amp;lt;MoreInfo&amp;gt;http://www.twilio.com/docs/errors/20003&amp;lt;/MoreInfo&amp;gt;&amp;lt;/RestException&amp;gt;&amp;lt;/TwilioResponse&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Versus this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl https://api.twilio.com/2010-04-01/Accounts.json
{"status":401,"message":"Authenticate","code":20003,"more_info":"http:\/\/www.twilio.com\/docs\/errors\/20003"}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;:/ Returning JSON when your resource ends with &amp;#8216;.json&amp;#8217; isn&amp;#8217;t bad, but
not respecting the Accept header, even when you return the right MIME
type, is just unfortunate.&lt;/p&gt;

&lt;h2&gt;&amp;#8230; and a little Announcement&lt;/h2&gt;

&lt;p&gt;It seems that this is a topic that people are really interested in. Part
I of this article was pretty well-received, and I got lots of great
email and feedback from people. It was also made pretty clear by &lt;a href="http://twitter.com/#!/wayneeseguin/status/97733413611638784"&gt;a few&lt;/a&gt; people that
they want more content from me on this topic.&lt;/p&gt;

&lt;p&gt;So I decided to write a book about it. You can check out the site for
&amp;#8221;&lt;a href="http://getsomere.st"&gt;Get Some REST&lt;/a&gt;&amp;#8221;, and put in your email address. Then you&amp;#8217;ll get
updated when I start pre-release sales.&lt;/p&gt;

&lt;p&gt;So what&amp;#8217;s in &amp;#8220;Get Some REST&amp;#8221;? It&amp;#8217;s going to be a full description of how
to build RESTful web applications, from the ground up. Designing your
resources, laying out an API, all the details. I&amp;#8217;m going to try to keep
most of the content language-agnostic, but provide code samples in
Rails 3.1, as well.&lt;/p&gt;

&lt;p&gt;I plan on writing a bunch of content, and then releasing the book at
half-price in beta. Early adopters will be able to get their two cents
in, and I&amp;#8217;ll cover things they still have questions on. It&amp;#8217;ll be
available under a liberal license, in PDF, ePub, all that good stuff.&lt;/p&gt;

&lt;p&gt;I&amp;#8217;ve also set up a Twitter account at &lt;a href="http://twitter.com/#!/getsomerestbook"&gt;@getsomerestbook&lt;/a&gt;. I&amp;#8217;ll be tweeting updates about the book, and also other good content
related to RESTful design. Oh, and if you&amp;#8217;re on
&lt;a href="http://rstat.us"&gt;rstat.us&lt;/a&gt;, I also have an account that&amp;#8217;ll syndicate
the same content at &lt;a href="http://rstat.us/users/getsomerestbook"&gt;@getsomerestbook&lt;/a&gt; too.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=drzCj0YBRcs:5gIqSD8_UnI:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=drzCj0YBRcs:5gIqSD8_UnI:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=drzCj0YBRcs:5gIqSD8_UnI:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=drzCj0YBRcs:5gIqSD8_UnI:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=drzCj0YBRcs:5gIqSD8_UnI:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/drzCj0YBRcs" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/08/07/some-people-understand-rest-and-http.html</feedburner:origLink></entry>
  
  <entry>
    <title>Twitter is too important to be owned by Twitter</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/980zwpACdIU/twitter-is-to-important-to-be-owned-by-twitter.html" />
    <updated>2011-07-24T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/07/24/twitter-is-to-important-to-be-owned-by-twitter</id>
    <content type="html">&lt;p&gt;When I spoke on a panel at &lt;a href="http://therealtimereport.com/"&gt;RTLM NY &amp;#8216;11&lt;/a&gt;, I got a little rise out of
the crowd when I said &amp;#8220;Twitter is too important to be owned by Twitter.&amp;#8221;
This is still absolutely true, and yesterday was a great example of
that: the #fuckyouwashington debacle.&lt;/p&gt;

&lt;p&gt;If you haven&amp;#8217;t heard, &lt;a href="http://twitter.com/#!/jeffjarvis"&gt;Jeff Jarvis&lt;/a&gt;
started something on Twitter last night:&lt;/p&gt;

&lt;!– http://twitter.com/#!/jeffjarvis/status/94919366818279424 –&gt;


&lt;p&gt; &lt;style type=’text/css’&gt;.bbpBox94919366818279424 {background:url(http://a0.twimg.com/images/themes/theme1/bg.png) #C0DEED;padding:20px;} p.bbpTweet{background:#fff;padding:10px 12px 10px 12px;margin:0;min-height:48px;color:#000;font-size:18px !important;line-height:22px;-moz-border-radius:5px;-webkit-border-radius:5px} p.bbpTweet span.metadata{display:block;width:100%;clear:both;margin-top:8px;padding-top:12px;height:40px;border-top:1px solid #fff;border-top:1px solid #e6e6e6} p.bbpTweet span.metadata span.author{line-height:19px} p.bbpTweet span.metadata span.author img{float:left;margin:0 7px 0 0px;width:38px;height:38px} p.bbpTweet a:hover{text-decoration:underline}p.bbpTweet span.timestamp{font-size:12px;display:block}&lt;/style&gt; &lt;div class=’bbpBox94919366818279424’&gt;&lt;p class=’bbpTweet’&gt;Hey, Washington assholes, it&amp;#8217;s our country, our economy, our money. Stop fucking with it.&lt;span class=’timestamp’&gt;&lt;a title=’Sat Jul 23 23:58:35 +0000 2011’ href=’http://twitter.com/#!/jeffjarvis/status/94919366818279424’&gt;less than a minute ago&lt;/a&gt; via &lt;a href="http://www.echofon.com/" rel="nofollow"&gt;Echofon&lt;/a&gt; &lt;a href=’http://twitter.com/intent/favorite?tweet_id=94919366818279424’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/favorite.png’ /&gt; Favorite&lt;/a&gt; &lt;a href=’http://twitter.com/intent/retweet?tweet_id=94919366818279424’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/retweet.png’ /&gt; Retweet&lt;/a&gt; &lt;a href=’http://twitter.com/intent/tweet?in_reply_to=94919366818279424’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/reply.png’ /&gt; Reply&lt;/a&gt;&lt;/span&gt;&lt;span class=’metadata’&gt;&lt;span class=’author’&gt;&lt;a href=’http://twitter.com/jeffjarvis’&gt;&lt;img src=’http://a1.twimg.com/profile_images/41194122/blogdaddy_normal.jpg’ /&gt;&lt;/a&gt;&lt;strong&gt;&lt;a href=’http://twitter.com/jeffjarvis’&gt;Jeff Jarvis&lt;/a&gt;&lt;/strong&gt;&lt;br/&gt;jeffjarvis&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt; &lt;!– end of tweet –&gt;&lt;/p&gt;

&lt;!– http://twitter.com/#!/jeffjarvis/status/94920264428699648 –&gt;


&lt;p&gt; &lt;style type=’text/css’&gt;.bbpBox94920264428699648 {background:url(http://a0.twimg.com/images/themes/theme1/bg.png) #C0DEED;padding:20px;} p.bbpTweet{background:#fff;padding:10px 12px 10px 12px;margin:0;min-height:48px;color:#000;font-size:18px !important;line-height:22px;-moz-border-radius:5px;-webkit-border-radius:5px} p.bbpTweet span.metadata{display:block;width:100%;clear:both;margin-top:8px;padding-top:12px;height:40px;border-top:1px solid #fff;border-top:1px solid #e6e6e6} p.bbpTweet span.metadata span.author{line-height:19px} p.bbpTweet span.metadata span.author img{float:left;margin:0 7px 0 0px;width:38px;height:38px} p.bbpTweet a:hover{text-decoration:underline}p.bbpTweet span.timestamp{font-size:12px;display:block}&lt;/style&gt; &lt;div class=’bbpBox94920264428699648’&gt;&lt;p class=’bbpTweet’&gt;People, it&amp;#8217;s time to get fucking pissed off.&lt;span class=’timestamp’&gt;&lt;a title=’Sun Jul 24 00:02:09 +0000 2011’ href=’http://twitter.com/#!/jeffjarvis/status/94920264428699648’&gt;less than a minute ago&lt;/a&gt; via &lt;a href="http://www.echofon.com/" rel="nofollow"&gt;Echofon&lt;/a&gt; &lt;a href=’http://twitter.com/intent/favorite?tweet_id=94920264428699648’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/favorite.png’ /&gt; Favorite&lt;/a&gt; &lt;a href=’http://twitter.com/intent/retweet?tweet_id=94920264428699648’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/retweet.png’ /&gt; Retweet&lt;/a&gt; &lt;a href=’http://twitter.com/intent/tweet?in_reply_to=94920264428699648’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/reply.png’ /&gt; Reply&lt;/a&gt;&lt;/span&gt;&lt;span class=’metadata’&gt;&lt;span class=’author’&gt;&lt;a href=’http://twitter.com/jeffjarvis’&gt;&lt;img src=’http://a1.twimg.com/profile_images/41194122/blogdaddy_normal.jpg’ /&gt;&lt;/a&gt;&lt;strong&gt;&lt;a href=’http://twitter.com/jeffjarvis’&gt;Jeff Jarvis&lt;/a&gt;&lt;/strong&gt;&lt;br/&gt;jeffjarvis&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt; &lt;!– end of tweet –&gt;&lt;/p&gt;

&lt;!– http://twitter.com/#!/jeffjarvis/status/94920803346419712 –&gt;


&lt;p&gt; &lt;style type=’text/css’&gt;.bbpBox94920803346419712 {background:url(http://a0.twimg.com/images/themes/theme1/bg.png) #C0DEED;padding:20px;} p.bbpTweet{background:#fff;padding:10px 12px 10px 12px;margin:0;min-height:48px;color:#000;font-size:18px !important;line-height:22px;-moz-border-radius:5px;-webkit-border-radius:5px} p.bbpTweet span.metadata{display:block;width:100%;clear:both;margin-top:8px;padding-top:12px;height:40px;border-top:1px solid #fff;border-top:1px solid #e6e6e6} p.bbpTweet span.metadata span.author{line-height:19px} p.bbpTweet span.metadata span.author img{float:left;margin:0 7px 0 0px;width:38px;height:38px} p.bbpTweet a:hover{text-decoration:underline}p.bbpTweet span.timestamp{font-size:12px;display:block}&lt;/style&gt; &lt;div class=’bbpBox94920803346419712’&gt;&lt;p class=’bbpTweet’&gt;Can we start a Twitter chant: FUCK YOU, WASHINGTON! Pass it on.&lt;span class=’timestamp’&gt;&lt;a title=’Sun Jul 24 00:04:17 +0000 2011’ href=’http://twitter.com/#!/jeffjarvis/status/94920803346419712’&gt;less than a minute ago&lt;/a&gt; via &lt;a href="http://www.echofon.com/" rel="nofollow"&gt;Echofon&lt;/a&gt; &lt;a href=’http://twitter.com/intent/favorite?tweet_id=94920803346419712’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/favorite.png’ /&gt; Favorite&lt;/a&gt; &lt;a href=’http://twitter.com/intent/retweet?tweet_id=94920803346419712’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/retweet.png’ /&gt; Retweet&lt;/a&gt; &lt;a href=’http://twitter.com/intent/tweet?in_reply_to=94920803346419712’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/reply.png’ /&gt; Reply&lt;/a&gt;&lt;/span&gt;&lt;span class=’metadata’&gt;&lt;span class=’author’&gt;&lt;a href=’http://twitter.com/jeffjarvis’&gt;&lt;img src=’http://a1.twimg.com/profile_images/41194122/blogdaddy_normal.jpg’ /&gt;&lt;/a&gt;&lt;strong&gt;&lt;a href=’http://twitter.com/jeffjarvis’&gt;Jeff Jarvis&lt;/a&gt;&lt;/strong&gt;&lt;br/&gt;jeffjarvis&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt; &lt;!– end of tweet –&gt;&lt;/p&gt;

&lt;p&gt;Lots of people were talking about the possibility of a &lt;a href="http://www.msnbc.msn.com/id/43864749/ns/politics-capitol_hill/t/congressional-leaders-work-avert-default/"&gt;government
default&lt;/a&gt;, but it ended up being a catch-all for any sort of venting
that citizens had against their government. And they had &lt;a href="https://plus.google.com/105076678694475690385/posts/iFyTBwVmyKs"&gt;a large
variety of things to say.&lt;/a&gt; But then, of course, this happens:&lt;/p&gt;

&lt;!– http://twitter.com/#!/jeffjarvis/status/94945261050273792 –&gt;


&lt;p&gt; &lt;style type=’text/css’&gt;.bbpBox94945261050273792 {background:url(http://a0.twimg.com/images/themes/theme1/bg.png) #C0DEED;padding:20px;} p.bbpTweet{background:#fff;padding:10px 12px 10px 12px;margin:0;min-height:48px;color:#000;font-size:18px !important;line-height:22px;-moz-border-radius:5px;-webkit-border-radius:5px} p.bbpTweet span.metadata{display:block;width:100%;clear:both;margin-top:8px;padding-top:12px;height:40px;border-top:1px solid #fff;border-top:1px solid #e6e6e6} p.bbpTweet span.metadata span.author{line-height:19px} p.bbpTweet span.metadata span.author img{float:left;margin:0 7px 0 0px;width:38px;height:38px} p.bbpTweet a:hover{text-decoration:underline}p.bbpTweet span.timestamp{font-size:12px;display:block}&lt;/style&gt; &lt;div class=’bbpBox94945261050273792’&gt;&lt;p class=’bbpTweet’&gt;Search for trending topic Schmucks and then search for &lt;a href="http://twitter.com/search?q=%23fuckyouwashington" title="#fuckyouwashington" class="tweet-url hashtag" rel="nofollow"&gt;#fuckyouwashington&lt;/a&gt;. No comparison. Blowing past it.&lt;span class=’timestamp’&gt;&lt;a title=’Sun Jul 24 01:41:28 +0000 2011’ href=’http://twitter.com/#!/jeffjarvis/status/94945261050273792’&gt;less than a minute ago&lt;/a&gt; via &lt;a href="http://www.echofon.com/" rel="nofollow"&gt;Echofon&lt;/a&gt; &lt;a href=’http://twitter.com/intent/favorite?tweet_id=94945261050273792’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/favorite.png’ /&gt; Favorite&lt;/a&gt; &lt;a href=’http://twitter.com/intent/retweet?tweet_id=94945261050273792’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/retweet.png’ /&gt; Retweet&lt;/a&gt; &lt;a href=’http://twitter.com/intent/tweet?in_reply_to=94945261050273792’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/reply.png’ /&gt; Reply&lt;/a&gt;&lt;/span&gt;&lt;span class=’metadata’&gt;&lt;span class=’author’&gt;&lt;a href=’http://twitter.com/jeffjarvis’&gt;&lt;img src=’http://a1.twimg.com/profile_images/41194122/blogdaddy_normal.jpg’ /&gt;&lt;/a&gt;&lt;strong&gt;&lt;a href=’http://twitter.com/jeffjarvis’&gt;Jeff Jarvis&lt;/a&gt;&lt;/strong&gt;&lt;br/&gt;jeffjarvis&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt; &lt;!– end of tweet –&gt;&lt;/p&gt;

&lt;!– http://twitter.com/#!/jaycousins/status/95106114391261184 –&gt;


&lt;p&gt; &lt;style type=’text/css’&gt;.bbpBox95106114391261184 {background:url(http://a2.twimg.com/profile_background_images/32742344/jaytwitter.jpg) #9AE4E8;padding:20px;} p.bbpTweet{background:#fff;padding:10px 12px 10px 12px;margin:0;min-height:48px;color:#000;font-size:18px !important;line-height:22px;-moz-border-radius:5px;-webkit-border-radius:5px} p.bbpTweet span.metadata{display:block;width:100%;clear:both;margin-top:8px;padding-top:12px;height:40px;border-top:1px solid #fff;border-top:1px solid #e6e6e6} p.bbpTweet span.metadata span.author{line-height:19px} p.bbpTweet span.metadata span.author img{float:left;margin:0 7px 0 0px;width:38px;height:38px} p.bbpTweet a:hover{text-decoration:underline}p.bbpTweet span.timestamp{font-size:12px;display:block}&lt;/style&gt; &lt;div class=’bbpBox95106114391261184’&gt;&lt;p class=’bbpTweet’&gt;WTF! &lt;a href="http://twitter.com/search?q=%23fuckyouwashington" title="#fuckyouwashington" class="tweet-url hashtag" rel="nofollow"&gt;#fuckyouwashington&lt;/a&gt; blocked from trending but not &lt;a href="http://twitter.com/search?q=%23blamethemuslims" title="#blamethemuslims" class="tweet-url hashtag" rel="nofollow"&gt;#blamethemuslims&lt;/a&gt; (mmm &lt;a href="http://twitter.com/search?q=%23fuckyoutwitter" title="#fuckyoutwitter" class="tweet-url hashtag" rel="nofollow"&gt;#fuckyoutwitter&lt;/a&gt; ?)&lt;span class=’timestamp’&gt;&lt;a title=’Sun Jul 24 12:20:39 +0000 2011’ href=’http://twitter.com/#!/jaycousins/status/95106114391261184’&gt;less than a minute ago&lt;/a&gt; via web &lt;a href=’http://twitter.com/intent/favorite?tweet_id=95106114391261184’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/favorite.png’ /&gt; Favorite&lt;/a&gt; &lt;a href=’http://twitter.com/intent/retweet?tweet_id=95106114391261184’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/retweet.png’ /&gt; Retweet&lt;/a&gt; &lt;a href=’http://twitter.com/intent/tweet?in_reply_to=95106114391261184’&gt;&lt;img src=’http://si0.twimg.com/images/dev/cms/intents/icons/reply.png’ /&gt; Reply&lt;/a&gt;&lt;/span&gt;&lt;span class=’metadata’&gt;&lt;span class=’author’&gt;&lt;a href=’http://twitter.com/jaycousins’&gt;&lt;img src=’http://a2.twimg.com/profile_images/384407232/me5_normal.jpg’ /&gt;&lt;/a&gt;&lt;strong&gt;&lt;a href=’http://twitter.com/jaycousins’&gt;jaycousins&lt;/a&gt;&lt;/strong&gt;&lt;br/&gt;jaycousins&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt; &lt;!– end of tweet –&gt;&lt;/p&gt;

&lt;p&gt;As of right this second, when I &lt;a href="http://twitter.com/#!/search/realtime/%23fuckyouwashington"&gt;search for #fuckyouwashington on
Twitter&lt;/a&gt;, they&amp;#8217;re coming in at two or three a second. It&amp;#8217;s crazy. And
it&amp;#8217;s really interesting to read what people have to say, pro and con,
picking their own issues, all of that stuff. Yet, it&amp;#8217;s been removed from
the trending topics.&lt;/p&gt;

&lt;p&gt;Now, maybe this particular trend was simply blocked because of the
profanity. Sure, whatever. I don&amp;#8217;t like that, but some might. And
Twitter certainly allows all kinds of trends to stick around that would
also be &amp;#8216;offensive,&amp;#8217; for example, #babymakingsong, #turnoff, and
 #itsalwaystheuglypeople are currently trending. Don&amp;#8217;t even get me
started on trends like #whatblackgirlslike #whatwhitegirls like and the
other racially charged topics. Sure, fine, it&amp;#8217;s their site, they can do
whatever they want.&lt;/p&gt;

&lt;p&gt;That, however, is the root of the issue: they can do whatever they want.
And we&amp;#8217;re all beholden to them. Nothing we can do. Maybe I&amp;#8217;m not
sensitive to four letter words, and I &lt;em&gt;do&lt;/em&gt; want to hear about things
like this. Too bad, Twitter says no. Maybe I don&amp;#8217;t want &lt;a href="http://venturebeat.com/2011/07/08/twitter-adding-promoted-tweets-to-your-stream-this-summer/"&gt;promoted tweets
added to my stream&lt;/a&gt;. Too bad, Twitter says yes.&lt;/p&gt;

&lt;p&gt;And that&amp;#8217;s why I&amp;#8217;m feeling worse and worse about Twitter every day. It
sucks, because I really like Twiter, the website. But Twitter, the
company, really bums me out. They promised all of us nerds long ago that
they wouldn&amp;#8217;t do this kind of thing, and they&amp;#8217;re not keeping that
promise. Which means I&amp;#8217;m not really getting emotionally invested in
Twitter any more. It&amp;#8217;s still valuable enough to me to keep using, but I
can&amp;#8217;t care about it the way I used to.&lt;/p&gt;

&lt;p&gt;This is why we&amp;#8217;re still hacking away at &lt;a href="http://rstat.us"&gt;rstat.us&lt;/a&gt;. If you haven&amp;#8217;t
heard about it before, you can &lt;a href="http://blog.steveklabnik.com/2011/03/23/announcing-rstat-us.html"&gt;read my release announcement&lt;/a&gt;. If
you&amp;#8217;re lazier than that, here&amp;#8217;s the summary: rstat.us is a distributed,
open-source Twitter. You can use our public node at the website, or get
your own copy of the code and run your own, make whatever customizations
you&amp;#8217;d like, and you&amp;#8217;re still on equal footing with everyone else in the
network. We&amp;#8217;re on the cusp of a 1.0 announcement, and I&amp;#8217;d love to have
been able to make that in this post, but we&amp;#8217;re still working out some
last kinks. If you&amp;#8217;ve seen it before, you won&amp;#8217;t find much differences
right now, but we have 100% standards compliance, a complete visual
refresh, and some other fun goodies waiting in the wings, ready to come
out shortly.&lt;/p&gt;

&lt;p&gt;Just remember: if you use a service like Twitter that&amp;#8217;s controlled by a
company like Twitter, you have to play by their rules. And sometimes,
they&amp;#8217;ll change the rules, and it&amp;#8217;ll be time to move on.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=980zwpACdIU:ZHFHqodDrII:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=980zwpACdIU:ZHFHqodDrII:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=980zwpACdIU:ZHFHqodDrII:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=980zwpACdIU:ZHFHqodDrII:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=980zwpACdIU:ZHFHqodDrII:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/980zwpACdIU" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/07/24/twitter-is-to-important-to-be-owned-by-twitter.html</feedburner:origLink></entry>
  
  <entry>
    <title>Nobody Understands REST or HTTP</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/wd-fLWuUK94/nobody-understands-rest-or-http.html" />
    <updated>2011-07-03T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/07/03/nobody-understands-rest-or-http</id>
    <content type="html">&lt;p&gt;Update: Part II of this post is &lt;a href="http://blog.steveklabnik.com/2011/08/07/some-people-understand-rest-and-http.html"&gt;here&lt;/a&gt;. Check it out, and there&amp;#8217;s an announcement at the end!&lt;/p&gt;

&lt;p&gt;The more that I&amp;#8217;ve learned about web development, the more that I&amp;#8217;ve
come to appreciate the thoroughness and thoughtfulness of the authors of
the HTTP RFC and Roy Fielding&amp;#8217;s dissertation. It seems like the answers
to most problems come down to &amp;#8220;There&amp;#8217;s a section of the spec for that.&amp;#8221;
Now, obviously, they&amp;#8217;re not infallible, and I&amp;#8217;m not saying that there&amp;#8217;s
zero room for improvement. But it really disappoints me when people
don&amp;#8217;t understand the way that a given issue is supposed to be solved,
and so they make up a partial solution that solves their given case but
doesn&amp;#8217;t jive well with the way that everything else works. There are
valid criticisms of the specs, but they have to come from an informed
place about what the spec says in the first place.&lt;/p&gt;

&lt;p&gt;Let&amp;#8217;s talk about a few cases where either REST or HTTP (which is clearly
RESTful in its design) solves a common web development problem.&lt;/p&gt;

&lt;h3&gt;I need to design my API&lt;/h3&gt;

&lt;p&gt;This one is a bit more general, but the others build off of it, so bear
with me.&lt;/p&gt;

&lt;p&gt;The core idea of REST is right there in the name: &amp;#8220;Representational
State Transfer&amp;#8221; It&amp;#8217;s about transferring representations of the state&amp;#8230;
of resources. Okay, so one part isn&amp;#8217;t in the name. But still, let&amp;#8217;s
break this down.&lt;/p&gt;

&lt;h4&gt;Resources&lt;/h4&gt;

&lt;p&gt;From &lt;a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_2_1_1"&gt;Fielding&amp;#8217;s dissertation&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The key abstraction of information in REST is a resource. Any information
that can be named can be a resource: a document or image, a temporal service
(e.g. &amp;#8220;today&amp;#8217;s weather in Los Angeles&amp;#8221;), a collection of other resources, a
non-virtual object (e.g. a person), and so on. In other words, any concept that
might be the target of an author&amp;#8217;s hypertext reference must fit within the
definition of a resource. A resource is a conceptual mapping to a set of
entities, not the entity that corresponds to the mapping at any particular
point in time.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When we interact with a RESTful system, we&amp;#8217;re interacting with a set of
resources. Clients request resources from the server in a variety of
ways. But the key thing here is that resources are &lt;em&gt;nouns&lt;/em&gt;. So a RESTful
API consists of a set of URIs that map entities in your system to
endpoints, and then you use HTTP itself for the verbs. If your URLs have
action words in them, you&amp;#8217;re doing it wrong. Let&amp;#8217;s look at an example of
this, from the early days of Rails. When Rails first started messing
around with REST, the URLs looked like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/posts/show/1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If you use Rails today, you&amp;#8217;ll note that the corresponding URL is
this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/posts/1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Why? Well, it&amp;#8217;s because the &amp;#8216;show&amp;#8217; is unnecessary; you&amp;#8217;re performing a
GET request, and that demonstrates that you want to show that resource.
It doesn&amp;#8217;t need to be in the URL.&lt;/p&gt;

&lt;h4&gt;A digression about actions&lt;/h4&gt;

&lt;p&gt;Sometimes, you need to perform some sort of action, though. Verbs are
useful. So how&amp;#8217;s this fit in? Let&amp;#8217;s consider the example of transferring
money from one Account to another. You might decided to build a URI like
this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;POST /accounts/1/transfer/500.00/to/2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;to transfer $500 from Account 1 to Account 2. But this is wrong! What
you really need to do is consider the nouns. You&amp;#8217;re not transferring
money, you&amp;#8217;re creating a Transaction resource:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;POST /transactions HTTP/1.1
Host: &amp;lt;snip, and all other headers&amp;gt;

from=1&amp;amp;to=2&amp;amp;amount=500.00
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Got it? So then, it returns the URI for your new Transaction:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;HTTP/1.1 201 OK
Date: Sun, 3 Jul 2011 23:59:59 GMT
Content-Type: application/json
Content-Length: 12345
Location: http://foo.com/transactions/1

{"transaction":{"id":1,"uri":"/transactions/1","type":"transfer"}}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Whoah, &lt;a href="http://timelessrepo.com/haters-gonna-hateoas"&gt;HATEOS&lt;/a&gt;! Also, it
may or may not be a good idea to return this JSON as the body; the
important thing is that we have the Location header which tells us where
our new resource is. If we give a client the ID, they might try to
construct their own URL, and the URI is a little redundant, since we
have one in the Location. Regardless, I&amp;#8217;m leaving that JSON there,
because that&amp;#8217;s the way I typed it first. I&amp;#8217;d love to &lt;a href="mailto:steve@steveklabnik.com"&gt;hear your thoughts
on this&lt;/a&gt; if you feel strongly one way or
the other.&lt;/p&gt;

&lt;p&gt;EDIT: I&amp;#8217;ve since decided that yes, including the URI is a bad idea. The
Location header makes much more sense. More on this in Part ii, yet to
come.&lt;/p&gt;

&lt;p&gt;Anyway, so now we can GET our Transaction:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;GET /transactions/1 HTTP/1.1
Accept: application/json
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;and the response:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;HTTP/1.1 blah blah blah

{"id":1,"type":"transfer","status":"in-progress"}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So we know it&amp;#8217;s working. We can continue to poll the URI and see when
our transaction is finished, or if it failed, or whatever. Easy! But
it&amp;#8217;s about manipulating those nouns.&lt;/p&gt;

&lt;h4&gt;Representations&lt;/h4&gt;

&lt;p&gt;You&amp;#8217;ll notice a pair of headers in the above HTTP requests and
responses: Accept and Content-Type. These describe the different
&amp;#8216;representation&amp;#8217; of any given resource. From &lt;a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_2_1_2"&gt;Fielding&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;REST components perform actions on a resource by using a representation to
capture the current or intended state of that resource and transferring that
representation between components. A representation is a sequence of bytes,
plus representation metadata to describe those bytes. Other commonly used but
less precise names for a representation include: document, file, and HTTP
message entity, instance, or variant.&lt;/p&gt;

&lt;p&gt;A representation consists of data, metadata describing the data, and, on
occasion, metadata to describe the metadata (usually for the purpose of
verifying message integrity).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So &lt;code&gt;/accounts/1&lt;/code&gt; represents a resource. But it doesn&amp;#8217;t include the form
that the resource takes. That&amp;#8217;s what these two headers are for.&lt;/p&gt;

&lt;p&gt;This is also why adding &lt;code&gt;.html&lt;/code&gt; to the end of your URLs is kinda silly.
If I request &lt;code&gt;/accounts/1.html&lt;/code&gt; with an &lt;code&gt;Accept&lt;/code&gt; header of
&lt;code&gt;application/json&lt;/code&gt;, then I&amp;#8217;ll get JSON. The &lt;code&gt;Content-Type&lt;/code&gt; header is the
server telling us what kind of representation it&amp;#8217;s sending back as well.
The important thing, though, is that a given resource can have many
different representations. Ideally, there should be one unambiguous
source of information in a system, and you can get different
representations using &lt;code&gt;Accept&lt;/code&gt;.&lt;/p&gt;

&lt;h4&gt;State and Transfer&lt;/h4&gt;

&lt;p&gt;This is more about the way HTTP is designed, so I&amp;#8217;ll just keep this
short: Requests are designed to be stateless, and the server holds all
of the state for its resources. This is important for caching and a few
other things, but it&amp;#8217;s sort of out of the scope of this post.&lt;/p&gt;

&lt;p&gt;Okay. With all of that out of the way, let&amp;#8217;s talk about some more
specific problems that REST/HTTP solve.&lt;/p&gt;

&lt;h3&gt;I want my API to be versioned&lt;/h3&gt;

&lt;p&gt;The first thing that people do when they want a versioned API is to
shove a /v1/ in the URL. &lt;em&gt;&lt;em&gt;THIS IS BAD!!!!!1&lt;/em&gt;&lt;/em&gt;. &lt;code&gt;Accept&lt;/code&gt; solves this
problem. What you&amp;#8217;re really asking for is &amp;#8220;I&amp;#8217;d like the version two
representation of this resource.&amp;#8221; So use accept!&lt;/p&gt;

&lt;p&gt;Here&amp;#8217;s an example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;GET /accounts/1 HTTP/1.1
Accept: application/vnd.steveklabnik-v2+json
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You&amp;#8217;ll notice a few things: we have a + in our MIME type, and before it
is a bunch of junk that wasn&amp;#8217;t there before. It breaks down into three
things: &lt;code&gt;vnd&lt;/code&gt;, my name, and &lt;code&gt;v2&lt;/code&gt;. You can guess what v2 means, but what
about &lt;code&gt;vnd&lt;/code&gt;. It&amp;#8217;s a &lt;a href="http://tools.ietf.org/html/rfc4288#section-3.2"&gt;Vendor MIME Type&lt;/a&gt;.
After all, we don&amp;#8217;t really want just any old JSON, we want my specific
form of JSON. This lets us still have our one URL to represent our
resource, yet version everything appropriately.&lt;/p&gt;

&lt;p&gt;I got a comment from &lt;a href="http://avdi.org/"&gt;Avdi Grimm&lt;/a&gt; about this, too:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Here&amp;#8217;s an article you might find interesting: &lt;a href="http://www.informit.com/articles/article.aspx?p=1566460"&gt;http://www.informit.com/articles/article.aspx?p=1566460&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The author points out that MIMETypes can have parameters, which means you can actually have a mimetype that looks like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vnd.example-com.foo+json; version=1.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Sadly, Rails does not (yet) understand this format.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h3&gt;I&amp;#8217;d like my content to be displayed in multiple languages&lt;/h3&gt;

&lt;p&gt;This is related, but a little different. What about pages in different
languages? Again, we have a question of representation, not one of
content. /en/whatever is not appropriate here. Turns out, &lt;a href="http://tools.ietf.org/html/rfc2616#section-14.4"&gt;there&amp;#8217;s a
header for that: Accept-Language&lt;/a&gt;.
Respect the headers, and everything works out.&lt;/p&gt;

&lt;p&gt;Oh, and I should say this, too: this doesn&amp;#8217;t solve the problem of &amp;#8220;I&amp;#8217;d
like to read this article in Spanish, even though I usually browse in
English.&amp;#8221; Giving your users the option to view your content in different
ways is a good thing. Personally, I&amp;#8217;d consider this to fall out in two
ways:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It&amp;#8217;s temporary. Stick this option in the session, and if they have the
option set, it trumps the header. You&amp;#8217;re still respecting their usual
preferences, but allowing them to override it.&lt;/li&gt;
&lt;li&gt;It&amp;#8217;s more permanent. Make it some aspect of their account, and it
trumps a specific header. Same deal.&lt;/li&gt;
&lt;/ul&gt;


&lt;h3&gt;I&amp;#8217;d like my content to have a mobile view&lt;/h3&gt;

&lt;p&gt;Sounds like I&amp;#8217;m beating a dead horse, but again: it&amp;#8217;s a representation
question. In this case, you&amp;#8217;d like to vary the response by the
User-Agent: give one that&amp;#8217;s mobile-friendly. There&amp;#8217;s a whole list of
&lt;a href="http://www.w3.org/TR/mobile-bp/"&gt;mobile best practices&lt;/a&gt; that the w3c
recommends, but the short of it is this: the User-Agent should let you
know that you&amp;#8217;re dealing with a mobile device. For example, here&amp;#8217;s the
first iPhone UA:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Mozilla/5.0 (iPhone; U; CPU like Mac OS X; en) AppleWebKit/420+ (KHTML, like Gecko) Version/3.0 Mobile/1A543a Safari/419.3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then, once detecting you have a mobile User-Agent, you&amp;#8217;d give back a
mobile version of the site. Hosting it on a subdomain is a minor sin,
but really, like I said above, this is really a question of
representation, and so having two URLs that point to the same resource
is kinda awkward.&lt;/p&gt;

&lt;p&gt;Whatever you do, for the love of users, please don&amp;#8217;t detect these
headers, then redirect your users to m.whatever.com, at the root. One of my
local news websites does this, and it means that every time I try to follow a
link from Twitter in my mobile browser, I don&amp;#8217;t see their article, I see
their homepage. It&amp;#8217;s infuriating.&lt;/p&gt;

&lt;h3&gt;I&amp;#8217;d like to hide some of my content&lt;/h3&gt;

&lt;p&gt;Every once in a while, you see a story like this: &lt;a href="http://www.boingboing.net/2010/10/25/local-newspaper-boas.html"&gt;Local paper boasts
ultimate passive-agressive paywall policy&lt;/a&gt;.
Now, I find paywalls distasteful, but this is not the way to do it.
There are technological means to limit content on the web: making users
be logged-in to read things, for example.&lt;/p&gt;

&lt;p&gt;When this was discussed on Hacker News, &lt;a href="http://news.ycombinator.com/item?id=1834075"&gt;here&amp;#8217;s&lt;/a&gt;
what I had to say:&lt;/p&gt;

&lt;p&gt;nkurz:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I presume if I had an unattended roadside vegetable stand with a cash-box, that I&amp;#8217;d be able to prosecute someone who took vegetables without paying, certainly if they also made off with the cash-box. Why is this different on the web? And if a written prohibition has no legal standing, why do so many companies pay lawyers to write click-through &amp;#8220;terms of service&amp;#8221; agreements?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;me:&lt;/p&gt;

&lt;blockquote&gt;&lt;blockquote&gt;&lt;p&gt;Why is this different on the web?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let&amp;#8217;s go through what happens when I visit a web site. I type a URL in my bar, and hit enter. My web browser makes a request via http to a server, and the server inspects the request, determines if I should see the content or not, and returns either a 200 if I am allowed, and a 403 if I&amp;#8217;m not. So, by viewing their pages, I&amp;#8217;m literally asking permission, and being allowed.&lt;/p&gt;

&lt;p&gt;It sounds to me like a misconfiguration of their server; it&amp;#8217;s not doing what they want it to.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h3&gt;I&amp;#8217;d like to do some crazy ajax, yet have permalinks&lt;/h3&gt;

&lt;p&gt;This is an example of where the spec is obviously deficient, and so
something had to be done.&lt;/p&gt;

&lt;p&gt;As the web grew, AJAXy &amp;#8216;web applications&amp;#8217; started to become more and
more the norm. And so applications wanted to provide deep-linking
capabilities to users, but there&amp;#8217;s a problem: they couldn&amp;#8217;t manipulate
the URL with Javascript without causing a redirect. They &lt;em&gt;could&lt;/em&gt;
manipulate the anchor, though. You know, that part after the #. So,
Google came up with a convention: &lt;a href="http://code.google.com/web/ajaxcrawling/docs/getting-started.html"&gt;Ajax Fragments&lt;/a&gt;.
This fixed the problem in the short term, but then the spec got fixed in
the long term: &lt;a href="http://dev.w3.org/html5/spec-author-view/history.html"&gt;pushState&lt;/a&gt;.
This lets you still provide a nice deep URL to your users, but not have
that awkward #!.&lt;/p&gt;

&lt;p&gt;In this case, there was a legitimate technical issue with the spec, and
so it&amp;#8217;s valid to invent something. But then the standard improved, and
so people should stop using #! as HTML5 gains browser support.&lt;/p&gt;

&lt;h3&gt;In conclusion&lt;/h3&gt;

&lt;p&gt;Seriously, most of the problems that you&amp;#8217;re solving are social, not
technical. The web is decades old at this point, most people have
considered these kinds of problems in the past. That doesn&amp;#8217;t mean that
they always have the right answer, but they usually do have an answer,
and it&amp;#8217;d behoove you to know what it is before you invent something on
your own.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=wd-fLWuUK94:zDiwa8GhPOU:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=wd-fLWuUK94:zDiwa8GhPOU:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=wd-fLWuUK94:zDiwa8GhPOU:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=wd-fLWuUK94:zDiwa8GhPOU:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=wd-fLWuUK94:zDiwa8GhPOU:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/wd-fLWuUK94" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/07/03/nobody-understands-rest-or-http.html</feedburner:origLink></entry>
  
  <entry>
    <title>Single text, many masters</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/TNSolXl4Q1Q/single-text-many-masters.html" />
    <updated>2011-05-21T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/05/21/single-text-many-masters</id>
    <content type="html">&lt;p&gt;Hey everyone. Here&amp;#8217;s a draft of an essay I&amp;#8217;ve been working on. I&amp;#8217;d love
to hear your feedback.&lt;/p&gt;

&lt;p&gt;The word &amp;#8216;engineering&amp;#8217; has a deep connection to the word &amp;#8216;trade-offs&amp;#8217; in
my mind. Most engineering decisions come down to evaluating a few
differing alternatives, and often multiple factors end up being
negatively correlated. You can make something stronger, but then it will
be heavier. It can be made faster, but then it&amp;#8217;s significantly more
expensive. A good engineer is able to take all of these factors into
account, and design a system such that it maximizes its effectiveness
across the sum of all of the relevant constraints. No matter if you consider
the act of writing software an art, science, or engineering, its indisputable
that designing complex software systems is identical in this respect. There are
dozens of different metrics that system architects take into consideration while
crafting a plan of attack, but but there&amp;#8217;s a deeper question of balance
here that&amp;#8217;s significantly different than these more traditional
engineering issues.&lt;/p&gt;

&lt;p&gt;Text, in the form of source code, presents unique challenges of
composition. These difficulties all stem from the same root: source code is a
singular text, but must be intelligible to multiple, simultaneous
audiences. More traditional forms of authorship still take audience into
consideration, of course, but the decision to engage a diverse group of
people is the choice of the writer. While mass appeal may be
something that certain authors strive to attain, it&amp;#8217;s not an inherent
property of their chosen form of expression. Source code, while text,
inhabits a multiplicity of forms, and software developers are confronted
with this inherent multi-faceted complexity when composing any
particular software work. Some of these forms suit certain audiences
better than others, and so it falls to the programmer to manage which
form they are currently working in, consider which audience they are
attempting to write for, and arrange all of these forms amongst one
another in such a way that any particular audience is able to navigate
and extract the proper information from the source without confusion.&lt;/p&gt;

&lt;p&gt;In this post, I&amp;#8217;ll expand on the concept of audiences for code, and in a
future post, I&amp;#8217;ll explore the simultaneous forms that code takes.&lt;/p&gt;

&lt;h2&gt;The multitude of audiences&lt;/h2&gt;

&lt;h3&gt;The default audience: the computer&lt;/h3&gt;

&lt;blockquote&gt;&lt;p&gt;Science is what we understand well enough to explain to a computer. Art
is everything else we do.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Don Knuth&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;This may seem obvious, but the when considering the question of &amp;#8220;Who are
programs written for?&amp;#8221;, many would say &amp;#8220;The computer. Duh.&amp;#8221; In many
ways, a computer is the primary reader of a particular piece of source
code. The code that&amp;#8217;s given to a computer will be executed billions of
times per second, repeated, recalculated, and re-interpreted over and
over and over again.&lt;/p&gt;

&lt;p&gt;The computer&amp;#8217;s native understanding of software comes from machine
code. Machine code are the binary numbers that the CPU loads into memory
and processes directly. For example, here&amp;#8217;s a line of machine code for
an x86 machine that puts the value &amp;#8216;97&amp;#8217; into the AL register, graciously
stolen &lt;a href="http://en.wikipedia.org/wiki/Assembly_language#Assembly_language"&gt;from
Wikipedia&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;10110000 01100001
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;While most would consider this unintelligible, computers were actually
programmed this way at one time. My uncle actually did this by flipping
switches to set the binary and pushed a button to store it in memory.
Unfortunately, what&amp;#8217;s good for the computer isn&amp;#8217;t good for the human
programmer. This is why assembly language was created. Assembly language
has a 1 to 1 mapping to machine code, but is much easier for humans to
understand. Here&amp;#8217;s that same line in assembly:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;MOV AL, 61h       ; Load AL with 97 decimal (61 hex)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;MOV&lt;/code&gt; corresponds with &lt;code&gt;10110&lt;/code&gt;, &lt;code&gt;AL&lt;/code&gt; maps to &lt;code&gt;000&lt;/code&gt;, and 61 hex is
&lt;code&gt;01100001&lt;/code&gt;. &lt;code&gt;MOV&lt;/code&gt; is short for &amp;#8216;move,&amp;#8217; though, and this mnemonic is just
a bit easier to understand than &lt;code&gt;10110&lt;/code&gt;. This is the most basic example
of a compositional trade-off. It&amp;#8217;s not a true trade-off, because they
map perfectly to one another, but it illustrates the difference between
composing in a language that the computer understands and one that&amp;#8217;s
more natural for the programmer. Another important concept comes into
play, that of &lt;em&gt;compilation&lt;/em&gt;. Virtually every work of composition created
in software is automatically translated to another form before it is
executed. We&amp;#8217;ll address this concept more fully when we discuss form
later.&lt;/p&gt;

&lt;p&gt;If that&amp;#8217;s where assembly stopped, it would remain a 1 to 1 mapping.
However, virtually every assembly language also offers macros, and this
moves the code further away from the machine and destroys the
synchrony of the two forms. Here&amp;#8217;s an example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;MOV EAX, [EBX]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;[]&lt;/code&gt; characters change the meaning of &lt;code&gt;EBX&lt;/code&gt;, rather than be the
value stored in that particular register, they imply that the value is a
memory address, and we want to move the contents of that address to
&lt;code&gt;EAX&lt;/code&gt;. The generated machine code could now be processed into multiple
valid assembly forms, and so the transformation is only perfect in one
direction, even if it&amp;#8217;s possible to &amp;#8216;decompile&amp;#8217; it into one of those
possible encodings. This is considered to be an acceptable trade-off for
human readability; we very rarely want to turn machine code back into
assembly.&lt;/p&gt;

&lt;p&gt;There&amp;#8217;s also a jump between higher level languages, as well. Here&amp;#8217;s the
assembly statements that adds 2 and 3 together:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;MOV EAX, 2
ADD EAX, 3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;ADD&lt;/code&gt;, of course, is the statement that adds a number to the register
that&amp;#8217;s given. Now &lt;code&gt;EAX&lt;/code&gt; has the value 5. Here&amp;#8217;s the same code, but in C:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;int x = 2;
x = x + 3;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pretty simple. You can see how the C is much easier to understand; we
say what type &lt;code&gt;x&lt;/code&gt; is (an integer), and it&amp;#8217;s a bit more explicit. &lt;code&gt;x&lt;/code&gt; is
equal to &lt;code&gt;x&lt;/code&gt; + three. However, since the C is divorced from the machine,
and is written for the person, we can change our compiler to make
assembly code that works on a different kind of processor architecture.
If we were to compile the above C for x86_64, a 64 bit version of x86,
we might get some assembly that&amp;#8217;d look like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;MOVL RAX, 2
ADDL RAX, 3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;While this code looks similar to the above, it is quite different. This
uses the native 64 bit types, rather than the 32 bit types above. The
other important thing is that by writing code that&amp;#8217;s divorced from the
machine, and written for people, we&amp;#8217;re able to translate it into the
code for multiple machines. If we had written the assembly above, when
moving to another architecture, it would have required a total re-write.
And while this particular sample looks very similar, a more complex
piece of code will be significantly divergent, but I don&amp;#8217;t want to go
into the details of two kinds of assembly code. Because we can define
the languages for humans, and the language of computers is somewhat
beholden to the physical machine itself, it&amp;#8217;s significantly easier to do
the translation from C to the two kinds of machines, rather than trying
to translate from one machine to another. What we lose in this kind of
translation, though, is efficiency. Code that was hand-crafted for each
machine would be more performant, and better represent each individual
platform.&lt;/p&gt;

&lt;p&gt;Even though we may choose to use a language that&amp;#8217;s more understandable
to people, it still has to be understood by the computer in some form.
This translation will introduce some amount of penalty, and so it&amp;#8217;s
important that this gets taken into consideration. Sometimes, code must
be written in a way that&amp;#8217;s not easy for a person to read, because it&amp;#8217;s
easier for the computer to be efficient with a more opaque
implementation.&lt;/p&gt;

&lt;h3&gt;The reflexive audience: the programmer himself&lt;/h3&gt;

&lt;blockquote&gt;&lt;p&gt;Debugging is twice as hard as writing the code in the first place.
Therefore, if you write the code as cleverly as possible, you are, by
definition, not smart enough to debug it.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Brian Kernighan&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;Everyone who writes code has experienced this at some time or another.
You write a whole bunch of code, and then a few months goes by, and you
take a look at it, and it&amp;#8217;s absolutely unintelligible. This happens
because at the time of inception, the author of a particular piece of
code has an incredibly close relationship to it. As it was just written,
the code is obvious to the author. They&amp;#8217;re in the proper mindset to
understand the intention that was drawn upon to necessitate bringing
those lines into the world, and so no extra explanation is necessary. As
time goes on, however, the author becomes more close to the third
audience, other programmers. It&amp;#8217;s important for coders to recognize this
fact, and take preventative steps to ameliorate this confusion.&lt;/p&gt;

&lt;p&gt;Even though the author will approach the position of the other audience
eventually, this audience is distinct because there is a certain level
of explanation that sits between undocumented, inexpressive code and
code that&amp;#8217;s well explained, and this is the position most code is in. An
explanation that&amp;#8217;s helpful to those who understand the code, but not to
those who don&amp;#8217;t is better than nothing. This sort of code may be overly
contextual, and could use some added information to improve its clarity.&lt;/p&gt;

&lt;h3&gt;The other audience: colleagues and coworkers&lt;/h3&gt;

&lt;blockquote&gt;&lt;p&gt;Always code as if the guy who ends up maintaining your code is a violent
psychopath who knows where you live.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Martin Golding&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;As I touched on earlier, there&amp;#8217;s a similarity between the &amp;#8216;other&amp;#8217;
audience and the reflexive. The primary distinction is drawn around the
proximity to the source. The other does not have the advantage of having
authored the code, and therefore doesn&amp;#8217;t have the native&amp;#8217;s understanding
of the underlying logical organization of the source. This disadvantage
can be overcome via composing in such a manner that the meaning is
emergent from the design. Even if it&amp;#8217;s too complex to be obvious, good
documentation can address this particular deficiency.&lt;/p&gt;

&lt;p&gt;Ultimately, much of software design is about modeling. Software that
solves a particular problem should emulate the nature of the challenge
it&amp;#8217;s attempting to address. If this can be achieved, it&amp;#8217;s significantly
easier for those who understand the problem to figure out how the
software works. Therefore, good design can help improve the
effectiveness of a given piece of source to communicate its intent.
Along a similar vector, if the design is similar to code that solves a
particular issue, it&amp;#8217;s easier to understand. As an example, a friend
recently asked for feedback about an interface that he&amp;#8217;d designed. It
loaded a save game file for StarCraft 2. This is what he came up with:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;replay_file = File.new("spec/fixtures/1v1-game1.sc2replay")
@replay = SC2Refinery::Parser.parse(replay_file)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;However, Ruby already has several kinds of code in its standard library
that loads some information from disk and parses it into some kind of
data structure that you can use in your program. The JSON, YAML, and
Marshall classes already use a set of methods to import and export data,
and they&amp;#8217;re named &lt;code&gt;load&lt;/code&gt; and &lt;code&gt;dump&lt;/code&gt;, and they&amp;#8217;re part of the class
directly. Also, in this case, the user of the code shouldn&amp;#8217;t need to
deal with the creation of a file, since it&amp;#8217;s unreasonable to assume that
a game replay would come from any other source. Therefore, after some
discussion, he adopted the following interface instead:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@replay = SC2Refinery.load("spec/fixtures/1v1-game1.sc2replay")
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is much nicer to use, and is much simpler. While it may not seem
like a whole lot, when rules like this are applied across an entire
codebase, they can significantly increase understanding. Multiple
reductions of mental overhead add up quickly.&lt;/p&gt;

&lt;p&gt;My new favorite trick for adding a little bit of modeling that
significantly reduces overhead for the user is the Presenter Pattern.
Jeff Casimir demonstrated this very clearly in his presentation at
RailsConf 2011, &amp;#8221;&lt;a href="http://dl.dropbox.com/u/69001/Fat%20Models%20Aren%27t%20Enough%20-%20RailsConf.pdf"&gt;Fat Models Aren&amp;#8217;t
Enough&lt;/a&gt;&amp;#8221;.
Here&amp;#8217;s a slightly modified example. Imagine that we have a system that
manages students, and we&amp;#8217;d like to display a report card for them. We
might start with some code that looks like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;student = Student.find(options[:student_id])
term = Term.find(options[:term_id])
report_type = ReportType.find(options[:report_type])

puts "#{student.last_name}, #{student.first_name}"
puts "#{report_type.report_title} for #{term.start_date} to #{term.end_date}"
student.courses.each do |course|
  course_report = student.report_data_for_course(course)
  puts course_report.to_s
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Honestly, until this past week, this is the exact code that I would have
written. But it turns out that we can do better. Basically, we&amp;#8217;re
displaying some information that comes from a combination of three
different objects. If we think about it some more, we&amp;#8217;re really trying
to display a report card. So let&amp;#8217;s make an object that represents the
card, and delegates to its sub-objects. It will then know how to display
itself.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class ReportCard
  delegate :start_date, :end_date, :to =&amp;gt; :term
  delegate :first_name, :last_name, :courses, :report_data_for_course, :to =&amp;gt; :student
  delegate :report_title, :to =&amp;gt; :report_type

  def initialize(params)
    @student = Student.find params[:student_id]
    @term = Term.find params[:term_id]
    @report_type = ReportType.find params[:report_type_id]
  end

  def student_name
    [last_name, first_name].join(", ")
  end

  def title
    "#{report_title} for #{start_date} to #{end_date}"
  end

  def course_reports
    out = ""
    courses.each do |course|
      out += report_data_for_course(course)
    end
    out
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now, this is a lot of code. However, as you can see, it&amp;#8217;s all focused on
composing the information and exposing an interface that makes sense for
a report card. Using it is super easy:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;report = ReportCard.new(options)
puts report.student_name
puts report.title
puts report.course_reports
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Bam! It&amp;#8217;s incredibly obvious. This code is much more clear than before.
We&amp;#8217;ll see if I&amp;#8217;m still as hot on this pattern as I am now in a few
months, but I feel the extra object adds a significant amount of
clarity.&lt;/p&gt;

&lt;p&gt;If the model is too hard to create, or if additional clarity is needed,
documentation in the form of comments can also help to improve the
understanding of the &amp;#8216;other&amp;#8217; audience. Comments can be a difficult form
of prose to write, because they need to be written at the correct level
of abstraction. If they simply repeat what the code does, they&amp;#8217;re
useless, and if they&amp;#8217;re too high-level, certain details and semantics
may not be made clear.&lt;/p&gt;

&lt;p&gt;Individual bits of code can also be made more clear by developing a
narrative within any particular method that&amp;#8217;s being written. Telling a
story with code may not be something you&amp;#8217;ve considered before, but it&amp;#8217;s
really about maintaining a proper flow in the actions your code is
taking. For example, if there&amp;#8217;s a bunch of error handling strewn about
inside of a method, it&amp;#8217;s less clear than bunching all of the error
handling near the end. Most code should be an act in three parts: input,
processing, and output. If these three parts are mixed together, it can
appear much more complicated.&lt;/p&gt;

&lt;h3&gt;The forgotten audience: end-users&lt;/h3&gt;

&lt;blockquote&gt;&lt;p&gt;If I asked my customers what they wanted, they&amp;#8217;d have told me, &amp;#8220;A
faster horse.&amp;#8221;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Henry Ford&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;In the end, all software is used by someone. Use-value is the driving
force of virtually all code. Code that doesn&amp;#8217;t do anything may be making
some kind of important philosophical statement, but isn&amp;#8217;t really the
sort that I&amp;#8217;m talking about.&lt;/p&gt;

&lt;p&gt;The introduction of a user imposes significant restrictions upon the way
that code is composed. End-users do not need to understand the code
itself, but they do need to be able to understand its external
interfaces. These needs place an imposition on the way that the code
needs to be written, because it &lt;em&gt;must&lt;/em&gt; address this issue of interface.
Sometimes, interface requirements can create a burden on the internal
implementation. Needing to support certain behaviors and forms can
create complexity for an implementor.&lt;/p&gt;

&lt;p&gt;Documentation created for end users must be completely different than
that which is created for those inspecting the code itself. Most
end-users will not be literate in the arts of software development, and
so approach the software object in an entirely different way than those
who write code do. Yet, the same semantics must be passed on to them,
but at a higher level. There&amp;#8217;s a strong movement within the community to
start designing software with this kind of end-user documentation in
mind, called &lt;a href="http://tom.preston-werner.com/2010/08/23/readme-driven-development.html"&gt;README driven development&lt;/a&gt;.
There are advantages to thinking on this level when beginning, but a
nice effect of doing it first is that you can ensure it gets done. A
surprising amount of software has poor documentation for its users,
because it&amp;#8217;s created after the software is finished, and at that time
there&amp;#8217;s intense pressure to ship it out the door. Writing down
information for the end user first ensures that it&amp;#8217;s done properly, that
all development works in accordance with the documentation, and that all
of the use-cases for an end-user have been thought of and are being
addressed.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=TNSolXl4Q1Q:EbP5aJn6TCk:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=TNSolXl4Q1Q:EbP5aJn6TCk:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=TNSolXl4Q1Q:EbP5aJn6TCk:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=TNSolXl4Q1Q:EbP5aJn6TCk:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=TNSolXl4Q1Q:EbP5aJn6TCk:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/TNSolXl4Q1Q" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/05/21/single-text-many-masters.html</feedburner:origLink></entry>
  
  <entry>
    <title>The next iteration of my blog</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/yFt7QlrV-8I/the-next-iteration-of-my-blog.html" />
    <updated>2011-05-12T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/05/12/the-next-iteration-of-my-blog</id>
    <content type="html">&lt;p&gt;Well well well, some things never change. Long ago, I hosted my own
blog, and here we are again. I&amp;#8217;ve moved everything over to Jekyll, if
that means anything to you. You can now &lt;a href="https://github.com/steveklabnik/blog"&gt;look at my blog on
GitHub&lt;/a&gt;. Big thanks to &lt;a href="http://www.jstorimer.com/2009/12/29/jekyll-on-heroku.html"&gt;this
article&lt;/a&gt; for
lots of help and pointers with final deployment stuff, and &lt;a href="http://mikeferrier.ca/2011/04/29/blogging-with-jekyll-haml-sass-and-jammit/"&gt;this one&lt;/a&gt; for haml and sass and stuff. Yay!&lt;/p&gt;

&lt;h2&gt;New-ish beginnings&lt;/h2&gt;

&lt;p&gt;So why&amp;#8217;d I do this? Well, this is just part of moving more towards
hosting all of my own services, and not relying on services that others
provide. This isn&amp;#8217;t some sort of argument over individualism vs.
collectivism, it&amp;#8217;s more about &lt;a href="http://nomoresharecropping.org/"&gt;No More Sharecropping&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&amp;#8217;m still relying on people for hosting, of course. Nobody is 100%
removed, but with my own backup of everything, I&amp;#8217;m in total control
here. It&amp;#8217;s really minimal work to keep this going, and only a few hours
of setup to move everything over.&lt;/p&gt;

&lt;h2&gt;A small change in focus, too&lt;/h2&gt;

&lt;p&gt;I&amp;#8217;m also going to stop bitching about politics so often, and try to be
more constructive in general. I have a lot to say about this new
humanities angle that my life has taken as of late. Hence, I&amp;#8217;ve changed
the title of my blog. And you can expect more posts along those lines.
More about books, more about art and code, less whining. One may think
I&amp;#8217;m maturing or something&amp;#8230;&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=yFt7QlrV-8I:PCawxc89QQk:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=yFt7QlrV-8I:PCawxc89QQk:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=yFt7QlrV-8I:PCawxc89QQk:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=yFt7QlrV-8I:PCawxc89QQk:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=yFt7QlrV-8I:PCawxc89QQk:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/yFt7QlrV-8I" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/05/12/the-next-iteration-of-my-blog.html</feedburner:origLink></entry>
  
  <entry>
    <title>Contributing to Ruby’s Documentation</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/WtdxNbNATWE/contributing-to-ruby-s-documentation.html" />
    <updated>2011-05-10T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/05/10/contributing-to-ruby-s-documentation</id>
    <content type="html">&lt;h3&gt;Update!&lt;/h3&gt;

&lt;p&gt;I&amp;#8217;m now making it even easier than this: &lt;a href="http://blog.steveklabnik.com/2011/08/22/im-making-it-dead-simple-to-contribute-to-ruby-s-documentation.html"&gt;Read my new post about how
I&amp;#8217;ll do this for you&lt;/a&gt;. That said, if you want to do it yourself, the following will tell you how.&lt;/p&gt;

&lt;h3&gt;Original Article&lt;/h3&gt;

&lt;p&gt;Ruby 1.9.3 is coming out soon! &lt;a href="http://blog.segment7.net/2011/05/09/ruby-1-9-3-documentation-challenge"&gt;drbrain has challenged the Ruby community to
improve its documentation&lt;/a&gt;, but some people were asking about how to do so.
So I made a video!&lt;/p&gt;

&lt;p&gt;Some small errata: drbrain has informed me that he should edit the Changelog,
not me. So don&amp;#8217;t do that. :)&lt;/p&gt;

&lt;iframe src="http://player.vimeo.com/video/23522731?title=0&amp;amp;byline=0&amp;amp;portrait=0" width="400" height="300" frameborder="0"&gt;&lt;/iframe&gt;


&lt;p&gt;&lt;a href="http://vimeo.com/23522731"&gt;How to contribute to Ruby&amp;#8217;s documentation.&lt;/a&gt; from &lt;a href="http://vimeo.com/steveklabnik"&gt;Steve Klabnik&lt;/a&gt; on &lt;a href="http://vimeo.com"&gt;Vimeo&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;If you don&amp;#8217;t want to watch me talk about it, here&amp;#8217;s the same info, in text:&lt;/p&gt;

&lt;p&gt;Getting the Ruby source is pretty easy. You can find it on GitHub, here:
&lt;a href="http://github.com/ruby/ruby"&gt;http://github.com/ruby/ruby&lt;/a&gt; . Click the &amp;#8220;fork&amp;#8221; button and clone down your
own fork:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git clone git@github.com:YOURUSERNAME/ruby.git
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After that&amp;#8217;s done, type &lt;code&gt;cd ruby&lt;/code&gt; and add the main project as an upstream. This will
let you keep up-to-date with the latest changes:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git remote add upstream https://github.com/ruby/ruby.git

$ git fetch upstream
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Okay! Now that you&amp;#8217;re all set up, poke around and find something that needs
documented. I like to just look through the source, but you can also look
&lt;a href="http://segment7.net/projects/ruby/documentation_coverage.txt"&gt;here&lt;/a&gt; for a list of things that have no docs. Documentation is written in
rdoc, and I&amp;#8217;d check the recent commits that drbrain has been making to guide
you in style. &lt;a href="https://github.com/ruby/ruby/commit/071a678a156dde974d8e470b659c89cb02b07b3b"&gt;This commit&lt;/a&gt;, for example, is a pretty good template. You
can also check out the formatting guides &lt;a href="http://rdoc.rubyforge.org/RDoc/Markup.html"&gt;here&lt;/a&gt;. There&amp;#8217;s also &lt;a href="http://rdoc.rubyforge.org/RDoc/Parser/Ruby.html"&gt;this&lt;/a&gt;
which explains some directives for .rb files and &lt;a href="http://rdoc.rubyforge.org/RDoc/Parser/C.html"&gt;this&lt;/a&gt; which handles
directives for .c files.&lt;/p&gt;

&lt;p&gt;Now that you&amp;#8217;ve made a change to the documentation, you can regenerate the
docs by using rdoc. First, grab the latest version from rubygems:&lt;/p&gt;

&lt;p&gt;   $ gem install rdoc&lt;/p&gt;

&lt;p&gt;Always best to have the latest tools. Now do this to generate the docs:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ rdoc –o tmpdoc lib/rss*
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I&amp;#8217;m passing it in an output directory with op, since the doc directory is not
an rdoc directory. rdoc will complain and refuse to overwrite those files,
which is a good thing. I&amp;#8217;m also passing in a pattern of what to compile
documentation for, compiling all of it takes a few minutes! In this case, I
chose to document the rss library.&lt;/p&gt;

&lt;p&gt;Now you have a website in rdocout. Open up its index.html, and poke around for
what you&amp;#8217;ve changed. If it all looks good, you&amp;#8217;re ready to make a patch!&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ rm -r rdocout

$ git add .

$ git commit -m "adding documentation for $SOMETHING"
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now, you have two options here. One is to simply push the change up to GitHub,
and make a pull request.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git push origin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&amp;#8230; aaand pull request. The core Ruby development doesn&amp;#8217;t really happen on
GitHub though, and so your patch may take a while to get included. If you
really want to do it right, submit a patch to RedMine. We&amp;#8217;ll use git to make
this patch:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git format-patch HEAD~1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This says &amp;#8220;make a patch out of the last commit.&amp;#8221; It&amp;#8217;ll tell you a file name,
it should start with 000.&lt;/p&gt;

&lt;p&gt;Now, sign up for the Ruby RedMine &lt;a href="http://redmine.ruby-lang.org/account/register"&gt;here&lt;/a&gt;. Once you&amp;#8217;ve clicked the
confirmation email, &lt;a href="http://redmine.ruby-lang.org/projects/ruby-19/issues/new"&gt;open a new ticket&lt;/a&gt;, and assign it to Eric Hodel,
category DOC, and give it your Ruby version, even though it&amp;#8217;s not a big deal
here. Click &amp;#8216;choose file&amp;#8217; and pick your patch, then &amp;#8216;create and continue&amp;#8217; and
BAM! You&amp;#8217;re done!&lt;/p&gt;

&lt;p&gt;Let&amp;#8217;s all pitch in and make this the best documented Ruby release ever! In
writing documentation, you might even find some things that you&amp;#8217;d like to help
improve. ;)&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=WtdxNbNATWE:vjkDly5QRgc:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=WtdxNbNATWE:vjkDly5QRgc:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=WtdxNbNATWE:vjkDly5QRgc:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=WtdxNbNATWE:vjkDly5QRgc:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=WtdxNbNATWE:vjkDly5QRgc:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/WtdxNbNATWE" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/05/10/contributing-to-ruby-s-documentation.html</feedburner:origLink></entry>
  
  <entry>
    <title>The first week of rstat.us: Users, Press, Scaling, oh my!</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/9A2UO8zvmGg/the-first-week-of-rstat-us-users-press-scaling-oh-my.html" />
    <updated>2011-03-30T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/03/30/the-first-week-of-rstat-us-users-press-scaling-oh-my</id>
    <content type="html">&lt;p&gt;Hey everyone. A lot of people have been asking me about &lt;a href="http://rstat.us"&gt;rstat.us&lt;/a&gt; lately,
so I figured I&amp;#8217;d tell a little bit of the story as it&amp;#8217;s gone down so far.&lt;/p&gt;

&lt;h2&gt;Stats&lt;/h2&gt;

&lt;p&gt;First, here&amp;#8217;s some numbers:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Users: 4553&lt;/li&gt;
&lt;li&gt;Uniques: 25,000&lt;/li&gt;
&lt;li&gt;Pageviews: 119,385&lt;/li&gt;
&lt;li&gt;Pages/visit: 4.77&lt;/li&gt;
&lt;li&gt;Statuses posted: 9387&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here&amp;#8217;s some fun info: stats on statuses by language:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;german 118&lt;/li&gt;
&lt;li&gt;russian 1355&lt;/li&gt;
&lt;li&gt;none 97 &amp;lt;- ha!&lt;/li&gt;
&lt;li&gt;english 4836&lt;/li&gt;
&lt;li&gt;spanish 1412&lt;/li&gt;
&lt;li&gt;dutch 98&lt;/li&gt;
&lt;li&gt;french 1155&lt;/li&gt;
&lt;li&gt;portuguese 272&lt;/li&gt;
&lt;li&gt;farsi 66&lt;/li&gt;
&lt;li&gt;pinyin 1&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Code&lt;/h2&gt;

&lt;p&gt;Lines, by committer:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;28 AndrewVos&lt;/li&gt;
&lt;li&gt;124 BRIMIL01&lt;/li&gt;
&lt;li&gt;6 Blaine Cook&lt;/li&gt;
&lt;li&gt;107 Brendan Taylor&lt;/li&gt;
&lt;li&gt;924 Brian Miller&lt;/li&gt;
&lt;li&gt;45 Caley Woods&lt;/li&gt;
&lt;li&gt;162 Carol Nichols&lt;/li&gt;
&lt;li&gt;20 Claudio Perez Gamayo&lt;/li&gt;
&lt;li&gt;1347 Dominic Dagradi&lt;/li&gt;
&lt;li&gt;4 James Larkby-Lahet&lt;/li&gt;
&lt;li&gt;99 Jorge H. Cuadrado&lt;/li&gt;
&lt;li&gt;258 Kat Hagan&lt;/li&gt;
&lt;li&gt;10 Lauren Voswinkel&lt;/li&gt;
&lt;li&gt;143 LindseyB&lt;/li&gt;
&lt;li&gt;16 MenTaLguY&lt;/li&gt;
&lt;li&gt;3 Michael Stevens&lt;/li&gt;
&lt;li&gt;3 Murilo Santana&lt;/li&gt;
&lt;li&gt;10 Nate Good&lt;/li&gt;
&lt;li&gt;1 Peter Aronoff&lt;/li&gt;
&lt;li&gt;24 Shebanian&lt;/li&gt;
&lt;li&gt;44 Stephen Paul Weber&lt;/li&gt;
&lt;li&gt;1409 Steve Klabnik&lt;/li&gt;
&lt;li&gt;8 Tony Arcieri&lt;/li&gt;
&lt;li&gt;478 Zachary Scott&lt;/li&gt;
&lt;li&gt;104 burningTyger&lt;/li&gt;
&lt;li&gt;28 james cook&lt;/li&gt;
&lt;li&gt;56 kat&lt;/li&gt;
&lt;li&gt;200 wilkie&lt;/li&gt;
&lt;li&gt;10 wolfwood&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also, wilkie has a lot more code in the 3 gems that we build off of, for our
ostatus implementation.&lt;/p&gt;

&lt;p&gt;That makes for 29 unique committers. These stats were generated by git-blame.&lt;/p&gt;

&lt;p&gt;Just over 200 pull requests&lt;/p&gt;

&lt;p&gt;872 commits&lt;/p&gt;

&lt;h2&gt;The deal with Heroku&lt;/h2&gt;

&lt;p&gt;Crazy! Such good stuff. I&amp;#8217;m really excited as to how it&amp;#8217;s going, but there
were a few rocky points along the way as well. Some people saw me tweeting in
frustration with Heroku, so here&amp;#8217;s the skinny:&lt;/p&gt;

&lt;p&gt;On Sunday, for some reason, our 3 line app.js file, as well as our
favicon.ico, started to take 60 seconds to respond. This meant that a dyno was
getting tied up, and since Heroku changed the way their mesh works, they kept
routing requests to these screwed up dynos. This caused a rash of 500 errors,
and I frantically filed a support ticket. This was the first time I&amp;#8217;d had a
paid app on Heroku, and they&amp;#8217;ve always been fantastic. The Hackety Hack site
was on the free account, and performed beautifully, with similar traffic.&lt;/p&gt;

&lt;p&gt;What it boils down to is this, though: Heroku took about 22 hours to respond
to my support ticket, in any way. Not like &amp;#8220;we&amp;#8217;re looking at it, but it&amp;#8217;s
Sunday, so it&amp;#8217;ll take a while.&amp;#8221; Crickets. Meanwhile, the errors kept
happening. Eventually, I heard something from them, where they pretty much
said &amp;#8216;I see other errors, try fixing those.&amp;#8217; with no response on the actual
root cause. I got an email from a Level2 person who promised to investigate
and escalate, but by now, I still haven&amp;#8217;t heard.&lt;/p&gt;

&lt;p&gt;I also had a smaller issue with MongoHQ. To their credit, I heard back Sunday
night, and the issue with them was an annoyance, not a showstopper. I ended up
hearing from the CEO, who ended up following up with me multiple times, and in
a pretty timely fashion.&lt;/p&gt;

&lt;p&gt;So, we moved our hosting away from Heroku and onto Duostack. Now, full
disclosure: I&amp;#8217;m friends with the guys from DuoStack. That said, they took care
of me. I found a small bug in their platform when deploying the app, but
everything&amp;#8217;s gone really well. Bunches of users have commented on how fast the
site is now, and I&amp;#8217;ve been really happy with it so far. We&amp;#8217;ll see how it goes.&lt;/p&gt;

&lt;h2&gt;The Future&lt;/h2&gt;

&lt;p&gt;Anyway, here&amp;#8217;s what&amp;#8217;s next for &lt;a href="http://rstat.us"&gt;rstat.us&lt;/a&gt;: The biggest thing is getting to
100% ostatus compliance. We spent lots of time this week getting screwed over
by a bug in Google&amp;#8217;s hub implementation, but now that it&amp;#8217;s all taken care of
now. While we work on that, we&amp;#8217;re also getting ready to deploy a statusnet
compliant API, so people can use statusnet clients on mobile and desktop. This
is huge for me, as I&amp;#8217;m really missing notifications.&lt;/p&gt;

&lt;p&gt;Other than that, just keep using it! Tell your friends! If you code, come join
us on the IRC (#rstatus on freenode), and help file bugs and patch them!&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=9A2UO8zvmGg:yoxD9014nFU:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=9A2UO8zvmGg:yoxD9014nFU:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=9A2UO8zvmGg:yoxD9014nFU:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=9A2UO8zvmGg:yoxD9014nFU:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=9A2UO8zvmGg:yoxD9014nFU:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/9A2UO8zvmGg" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/03/30/the-first-week-of-rstat-us-users-press-scaling-oh-my.html</feedburner:origLink></entry>
  
  <entry>
    <title>Announcing rstat.us</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/iqh2vr_JSWc/announcing-rstat-us.html" />
    <updated>2011-03-23T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/03/23/announcing-rstat-us</id>
    <content type="html">&lt;p&gt;Whew.&lt;/p&gt;

&lt;p&gt;If you&amp;#8217;ve been &lt;a href="http://twitter.com/steveklabnik"&gt;following me on Twitter&lt;/a&gt; at all lately, you&amp;#8217;ll know that
I&amp;#8217;ve been working hard on a new project lately. Tonight, even though it&amp;#8217;s
late, I&amp;#8217;m finally getting it out there. Please welcome &lt;a href="http://rstat.us/"&gt;http://rstat.us/&lt;/a&gt;
to the world! (as soon as the DNS updates. ;) )&lt;/p&gt;

&lt;p&gt;&lt;a href="http://rstat.us"&gt;rstat.us&lt;/a&gt; is a micro-blogging service, just like Twitter. There&amp;#8217;s one big
difference, though: it is distributed. Oh, and it&amp;#8217;s 100% open source. So two
things. It&amp;#8217;s also integrated with Facebook and Twitter, so you can just log in
with either of those accounts, and it&amp;#8217;ll syndicate your posts. Well, just to
Twitter right now, but we&amp;#8217;re getting there.&lt;/p&gt;

&lt;p&gt;Here&amp;#8217;s the other cool thing: Want to own your data? You can actually &lt;a href="http://github.com/hotsh/rstat.us"&gt;get the
code&lt;/a&gt; and run a copy yourself! But you won&amp;#8217;t get left out: you can follow
anyone else that uses the &lt;a href="http://ostatus.org/"&gt;ostatus&lt;/a&gt; protocol, like &lt;a href="http://identi.ca/"&gt;http://identi.ca/&lt;/a&gt;,
and it&amp;#8217;ll Just Work. You just have to grab the URL to their feed, put it in,
and it&amp;#8217;s all good! But you probably shouldn&amp;#8217;t do that yet. We&amp;#8217;re still working
on some features.&lt;/p&gt;

&lt;p&gt;&lt;a href="http://rstat.us"&gt;rstat.us&lt;/a&gt; is still very much alpha quality. 7 or 8 of my best friends and
I have been fighting off sleep, food, and tests for the last two weeks to put
this together. Please &lt;a href="http://rstat.us/"&gt;give it a try&lt;/a&gt; and let me know what you think, tell
me if you can break it, or anything else that&amp;#8217;s particularly interesting. If
you&amp;#8217;re the coding type, please check out the &lt;a href="http://github.com/hotsh/rstat.us/wiki"&gt;wiki&lt;/a&gt; for a big old list of
stuff we&amp;#8217;d like to do.&lt;/p&gt;

&lt;p&gt;Oh, and of course, you should &lt;a href="http://rstat.us/users/steveklabnik"&gt;follow me on rstat.us&lt;/a&gt;.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=iqh2vr_JSWc:qmKqfzD2Btk:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=iqh2vr_JSWc:qmKqfzD2Btk:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=iqh2vr_JSWc:qmKqfzD2Btk:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=iqh2vr_JSWc:qmKqfzD2Btk:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=iqh2vr_JSWc:qmKqfzD2Btk:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/iqh2vr_JSWc" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/03/23/announcing-rstat-us.html</feedburner:origLink></entry>
  
  <entry>
    <title>Did you hear? I’m Ruby Mendicant University’s first Visiting Teacher</title>
    <link href="http://feedproxy.google.com/~r/SteveKlabnik/~3/NacAC9cTI5g/did-you-hear-i-m-ruby-mendicant-university-s-first-visiting-teacher.html" />
    <updated>2011-03-18T00:00:00-05:00</updated>
    <id>http://blog.steveklabnik.com/2011/03/18/did-you-hear-i-m-ruby-mendicant-university-s-first-visiting-teacher</id>
    <content type="html">&lt;p&gt;I&amp;#8217;ve heard &lt;a href="http://university.rubymendicant.com/"&gt;Ruby Mendicant University&lt;/a&gt; (also known as RMU, not to confuse
you Robert Morris alums!) described as &amp;#8220;the best kept secret of the Ruby
community.&amp;#8221; High praise, indeed. If you haven&amp;#8217;t heard about RMU before, check
out this presentation by Andrew Cox: &lt;/p&gt;

&lt;p&gt;TL;DR: RMU is a free, online &amp;#8216;unversity&amp;#8217; from Gregory Brown, author of &amp;#8216;Ruby
Best Practices.&amp;#8217; You enter an intermediate Rubyist, and you exit an expert. &lt;/p&gt;

&lt;p&gt;Anyway, RMU recently announced that &lt;a href="http://university.rubymendicant.com/changelog/visiting-teacher-2011-t2-steve-klabnik"&gt;I&amp;#8217;ll be their first visiting teacher&lt;/a&gt;.
Basically, I&amp;#8217;ll be hanging out, giving advice, and just generally being even
more accessible to RMU students than I already am. Greg and I have talked a
lot about education, Ruby, and a lot of other things&amp;#8230; between Hackety&amp;#8217;s
&amp;#8216;nothing to intermediate&amp;#8217; and RMU&amp;#8217;s &amp;#8216;intermediate to expert&amp;#8217; approaches to
learning, anyone wanting to get up to speed with Ruby should have no shortage
of resources at their disposal.&lt;/p&gt;

&lt;p&gt;If you&amp;#8217;re feeling like you&amp;#8217;ve got the hang of Ruby, but want to take it to the
next level, &lt;a href="http://university.rubymendicant.com/admissions"&gt;applications are open&lt;/a&gt;! Hopefully I&amp;#8217;ll see you there.&lt;/p&gt;
&lt;div class="feedflare"&gt;
&lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=NacAC9cTI5g:LhLdbcVKEwU:yIl2AUoC8zA"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=yIl2AUoC8zA" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=NacAC9cTI5g:LhLdbcVKEwU:F7zBnMyn0Lo"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?i=NacAC9cTI5g:LhLdbcVKEwU:F7zBnMyn0Lo" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=NacAC9cTI5g:LhLdbcVKEwU:qj6IDK7rITs"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=qj6IDK7rITs" border="0"&gt;&lt;/img&gt;&lt;/a&gt; &lt;a href="http://feeds.feedburner.com/~ff/SteveKlabnik?a=NacAC9cTI5g:LhLdbcVKEwU:l6gmwiTKsz0"&gt;&lt;img src="http://feeds.feedburner.com/~ff/SteveKlabnik?d=l6gmwiTKsz0" border="0"&gt;&lt;/img&gt;&lt;/a&gt;
&lt;/div&gt;&lt;img src="http://feeds.feedburner.com/~r/SteveKlabnik/~4/NacAC9cTI5g" height="1" width="1"/&gt;</content>
  <feedburner:origLink>http://blog.steveklabnik.com/2011/03/18/did-you-hear-i-m-ruby-mendicant-university-s-first-visiting-teacher.html</feedburner:origLink></entry>
  
</feed>
